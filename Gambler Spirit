import telebot
from telebot import types
import json
import random
import os
import re
import atexit
from dotenv import load_dotenv  # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ø®Ø·

# Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ
load_dotenv()


TOKEN = '8592132316:AAH1iy7PKpO94Xmk3z8nClKYx2_OGPd1m8A'
ADMIN_ID = int(os.getenv('ADMIN_ID', '7667865587'))  # Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø²
CREATOR_ID = int(os.getenv('CREATOR_ID', '8577697948'))
GROUP_ID = os.getenv('GROUP_ID', '-1003521699425')
CARD_NUMBER = os.getenv('CARD_NUMBER', '6219861865604846')


TAX_RATE = 0.5
TRANSFER_TAX = 0.10

bot = telebot.TeleBot(TOKEN)


users = {}
active_games = {}
waiting_for_receipt = {}
user_messages = {}
waiting_for_admin_receipt = {}
admin_list = {}
waiting_for_admin_action = {}
admin_messages = {}
gift_codes = {}
waiting_for_gift_code = {}












def get_user(user_id):
    user_id = str(user_id)
    if user_id not in users:
        users[user_id] = {
            'coins': 0, 
            'username': '', 
            'first_name': '', 
            'used_codes': [],
            'referral_code': f'REF{user_id[-6:]}',  # Ú©Ø¯ Ù…Ø¹Ø±Ù Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯
            'referred_by': None,  # Ú†Ù‡ Ú©Ø³ÛŒ Ø§Ùˆ Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ø±Ø¯Ù‡
            'referral_count': 0,  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚
            'total_earned': 0     # Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡ Ø§Ø² Ø¯Ø¹ÙˆØª
        }
        save_data()
    # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³Øª Ùˆ Ø§ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    elif 'referral_code' not in users[user_id]:
        users[user_id]['referral_code'] = f'REF{user_id[-6:]}'
        users[user_id]['referred_by'] = users[user_id].get('referred_by', None)
        users[user_id]['referral_count'] = users[user_id].get('referral_count', 0)
        users[user_id]['total_earned'] = users[user_id].get('total_earned', 0)
        save_data()
    return users[user_id]




def load_data():
    global users, active_games, admin_list, gift_codes
    try:
        if os.path.exists('users.json'):
            with open('users.json', 'r', encoding='utf-8') as f:
                users = json.load(f)
                
            # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‚Ø¯ÛŒÙ…ÛŒ
            for user_id, user_data in users.items():
                if 'referral_code' not in user_data:
                    user_data['referral_code'] = f'REF{user_id[-6:]}'
                    user_data['referred_by'] = user_data.get('referred_by', None)
                    user_data['referral_count'] = user_data.get('referral_count', 0)
                    user_data['total_earned'] = user_data.get('total_earned', 0)
        
        if os.path.exists('games.json'):
            with open('games.json', 'r', encoding='utf-8') as f:
                active_games = json.load(f)
        
        if os.path.exists('admins.json'):
            with open('admins.json', 'r', encoding='utf-8') as f:
                admin_list = json.load(f)
        else:
            admin_list = {
                str(ADMIN_ID): {
                    'permissions': {
                        'send_receipt': True,
                        'add_coins': True,
                        'remove_coins': True,
                        'manage_gift_codes': True
                    }
                }
            }
        
        if os.path.exists('gift_codes.json'):
            with open('gift_codes.json', 'r', encoding='utf-8') as f:
                gift_codes = json.load(f)
    
    except Exception as e:
        print(f'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: {e}')
        print('Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ')
        users = {}
        active_games = {}
        admin_list = {}
        gift_codes = {}






def load_data():
    global users, active_games, admin_list, gift_codes
    try:
        if os.path.exists('users.json'):
            with open('users.json', 'r', encoding='utf-8') as f:
                users = json.load(f)
        if os.path.exists('games.json'):
            with open('games.json', 'r', encoding='utf-8') as f:
                active_games = json.load(f)
        if os.path.exists('admins.json'):
            with open('admins.json', 'r', encoding='utf-8') as f:
                admin_list = json.load(f)
        else:
            admin_list = {
                str(ADMIN_ID): {
                    'permissions': {
                        'send_receipt': True,
                        'add_coins': True,
                        'remove_coins': True,
                        'manage_gift_codes': True
                    }
                }
            }
        if os.path.exists('gift_codes.json'):
            with open('gift_codes.json', 'r', encoding='utf-8') as f:
                gift_codes = json.load(f)
    except:
        print('Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ')

def save_data():
    try:
        with open('users.json', 'w', encoding='utf-8') as f:
            json.dump(users, f, ensure_ascii=False, indent=2)
        with open('games.json', 'w', encoding='utf-8') as f:
            json.dump(active_games, f, ensure_ascii=False, indent=2)
        with open('admins.json', 'w', encoding='utf-8') as f:
            json.dump(admin_list, f, ensure_ascii=False, indent=2)
        with open('gift_codes.json', 'w', encoding='utf-8') as f:
            json.dump(gift_codes, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f'Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: {e}')

load_data()

def get_user(user_id):
    user_id = str(user_id)
    if user_id not in users:
        users[user_id] = {'coins': 0, 'username': '', 'first_name': '', 'used_codes': []}
        save_data()
    return users[user_id]

def get_main_keyboard():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row('ğŸ’³ Ø´Ø§Ø±Ú˜ Ù…ÙˆØ¬ÙˆØ¯ÛŒ', 'ğŸ Ø«Ø¨Øª Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡')
    keyboard.row('ğŸ¦ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ', 'ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§')
    keyboard.row('â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡')
    return keyboard

def get_admin_keyboard():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row('ğŸ’³ Ø´Ø§Ø±Ú˜ Ù…ÙˆØ¬ÙˆØ¯ÛŒ', 'ğŸ Ø«Ø¨Øª Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡')
    keyboard.row('ğŸ¦ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ', 'ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§')
    keyboard.row('â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡')
    
    keyboard.row('ğŸ” Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†')
    
    return keyboard

def get_coin_keyboard():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row('1', '2', '3')
    keyboard.row('4', '5', '6')
    keyboard.row('7', '8', '9')
    keyboard.row('âŒ«', '0', 'ØªØ§ÛŒÛŒØ¯ âœ…')
    keyboard.row('âŒ Ù„ØºÙˆ')
    return keyboard

def is_admin(user_id):
    return str(user_id) in admin_list or user_id == CREATOR_ID

def has_permission(user_id, permission):
    if user_id == CREATOR_ID:
        return True
    user_id_str = str(user_id)
    if user_id_str in admin_list:
        return admin_list[user_id_str]['permissions'].get(permission, False)
    return False






def get_user(user_id):
    user_id = str(user_id)
    if user_id not in users:
        users[user_id] = {
            'coins': 0, 
            'username': '', 
            'first_name': '', 
            'used_codes': [],
            'referral_code': f'REF{user_id[-6:]}',  # Ú©Ø¯ Ù…Ø¹Ø±Ù Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯
            'referred_by': None,  # Ú†Ù‡ Ú©Ø³ÛŒ Ø§Ùˆ Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ø±Ø¯Ù‡
            'referral_count': 0,  # ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚
            'total_earned': 0     # Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡ Ø§Ø² Ø¯Ø¹ÙˆØª
        }
        save_data()
    # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³Øª Ùˆ Ø§ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    elif 'referral_code' not in users[user_id]:
        users[user_id]['referral_code'] = f'REF{user_id[-6:]}'
        users[user_id]['referred_by'] = users[user_id].get('referred_by', None)
        users[user_id]['referral_count'] = users[user_id].get('referral_count', 0)
        users[user_id]['total_earned'] = users[user_id].get('total_earned', 0)
        save_data()
    return users[user_id]





@bot.callback_query_handler(func=lambda call: call.data == 'referral_stats')
def show_referral_stats(call):
    user_id = str(call.from_user.id)
    user = get_user(user_id)
    
    # Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†
    top_inviters = []
    for uid, udata in users.items():
        if udata.get('referral_count', 0) > 0:
            top_inviters.append({
                'id': uid,
                'name': udata['first_name'],
                'count': udata['referral_count'],
                'earned': udata.get('total_earned', 0)
            })
    
    # Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
    top_inviters.sort(key=lambda x: x['count'], reverse=True)
    
    text = "ğŸ† **Ø¨Ø±ØªØ±ÛŒÙ† Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† Ù‡ÙØªÙ‡**\n\n"
    
    medal_emojis = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰", "4ï¸âƒ£", "5ï¸âƒ£", "6ï¸âƒ£", "7ï¸âƒ£", "8ï¸âƒ£", "9ï¸âƒ£", "ğŸ”Ÿ"]
    
    for i, inviter in enumerate(top_inviters[:10], 1):
        if i <= 3:
            text += f"{medal_emojis[i-1]} **{inviter['name']}** - {inviter['count']} Ø¯Ø¹ÙˆØª ({inviter['earned']:,} Ø³Ú©Ù‡)\n"
        else:
            text += f"{i}. {inviter['name']} - {inviter['count']} Ø¯Ø¹ÙˆØª ({inviter['earned']:,} Ø³Ú©Ù‡)\n"
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø±ØªØ¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    user_rank = None
    for i, inviter in enumerate(top_inviters):
        if inviter['id'] == user_id:
            user_rank = i + 1
            break
    
    text += f"\nğŸ¯ **Ø¢Ù…Ø§Ø± Ø´Ù…Ø§:**\n"
    if user_rank:
        if user_rank <= 10:
            text += f"â€¢ Ø±ØªØ¨Ù‡ Ø´Ù…Ø§: {medal_emojis[user_rank-1] if user_rank <= 3 else user_rank}\n"
        else:
            text += f"â€¢ Ø±ØªØ¨Ù‡ Ø´Ù…Ø§: {user_rank}\n"
    else:
        text += f"â€¢ Ø±ØªØ¨Ù‡ Ø´Ù…Ø§: {len(top_inviters)+1} (Ù‡Ù†ÙˆØ² Ø¯Ø¹ÙˆØªÛŒ Ù†Ø¯Ø§Ø´ØªÙ‡â€ŒØ§ÛŒØ¯)\n"
    
    text += f"â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§: {user.get('referral_count', 0)}\n"
    text += f"â€¢ Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„: {user.get('total_earned', 0):,} Ø³Ú©Ù‡"
    
    if user.get('referral_count', 0) == 0:
        text += "\n\nğŸ’¡ **Ù†Ú©ØªÙ‡:** Ù‡Ù†ÙˆØ² Ú©Ø³ÛŒ Ø±Ø§ Ø¯Ø¹ÙˆØª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯! Ø§Ø² Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯! ğŸ"
    
    bot.send_message(call.message.chat.id, text, parse_mode='Markdown')
    bot.answer_callback_query(call.id, "ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§")



@bot.message_handler(commands=['invite'])
def invite_command(message):
    user_id = str(message.from_user.id)
    user = get_user(user_id)
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª
    bot_username = bot.get_me().username
    invite_link = f"https://t.me/{bot_username}?start={user['referral_code']}"
    
    text = f"""ğŸ¯ **Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø§Ø®ØªØµØ§ØµÛŒ Ø´Ù…Ø§**

ğŸ”— Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª:
`{invite_link}`

ğŸ“Š Ø¢Ù…Ø§Ø± Ø¯Ø¹ÙˆØª:
ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§: {user.get('referral_count', 0)} Ù†ÙØ±
ğŸ’° Ø³Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡: {user.get('total_earned', 0)} Ø³Ú©Ù‡

ğŸ **Ø¬ÙˆØ§ÛŒØ² Ø¯Ø¹ÙˆØª:**
â€¢ Ù‡Ø± Ø¯Ø¹ÙˆØª Ù…ÙˆÙÙ‚: ÛµÛ°Û° Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡!
â€¢ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø¹ÙˆØªâ€ŒØ´Ø¯Ù‡: Û²Û°Û° Ø³Ú©Ù‡ Ù‡Ø¯ÛŒÙ‡!

ğŸ“Œ **Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡:**
1. Ù„ÛŒÙ†Ú© Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ø¨ÙØ±Ø³ØªÛŒØ¯
2. Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù„ÛŒÙ†Ú© Ùˆ Ø²Ø¯Ù† /start Ø¹Ø¶Ùˆ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
3. Ø¬Ø§ÛŒØ²Ù‡ Ø´Ù…Ø§ Ùˆ Ø¯ÙˆØ³ØªØªØ§Ù† Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆØ§Ø±ÛŒØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯

ğŸ® **Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙÛŒØ¯:**
`/invite` - Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª
`ğŸ“¤ Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†` - Ø§Ø² Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ

ğŸ”¥ Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ± Ø¯Ø¹ÙˆØª Ú©Ù†ÛŒØ¯ØŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯!"""
    
    markup = types.InlineKeyboardMarkup()
    markup.row(
        types.InlineKeyboardButton("ğŸ“¤ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù„ÛŒÙ†Ú©", 
        url=f"https://t.me/share/url?url={invite_link}&text=ğŸ® Ø¨ÛŒØ§ ØªÙˆ Ø±Ø¨Ø§Øª Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Gambler Spirit! Ø¬ÙˆØ§ÛŒØ² Ù‡ÙØªÚ¯ÛŒ Û± ØªØ§ Û²Û° Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†! ğŸ†")
    )
    markup.row(
        types.InlineKeyboardButton("ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù…Ø§Ø±", callback_data="referral_stats"),
        types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©", callback_data=f"copy_link_{user['referral_code']}")
    )
    
    bot.send_message(message.chat.id, text, parse_mode='Markdown', reply_markup=markup)



@bot.message_handler(commands=['Support'])
def send_rules(message):
    bot.send_message(message.chat.id, """ğŸ‘¤ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒØŒ Ø¨Ù‡ Ø¢ÛŒØ¯ÛŒ Ø²ÛŒØ± Ù¾ÛŒØ§Ù… Ø¯Ù‡ÛŒØ¯:
       ğŸ†” @Kia_CODM
      â° Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ: 24 Ø³Ø§Ø¹ØªÙ‡""")



@bot.message_handler(commands=['add'])
def add_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    waiting_for_admin_action[str(message.from_user.id)] = {
        'step': 'add_coins_target',
        'target_user_id': target_id,
        'target_name': target_name
    }
    
    # Ù…Ù†ÙˆÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ + Ø§ÛŒÙ…ÙˆØ¬ÛŒ
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: 10000 ğŸª™
    markup.row(types.InlineKeyboardButton("ğŸª™ Û±Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_10000"))
    
    # Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: 100 ğŸª™ | 500 ğŸª™
    markup.row(
        types.InlineKeyboardButton("ğŸª™ Û±Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_100"),
        types.InlineKeyboardButton("ğŸª™ ÛµÛ°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_500")
    )
    
    # Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…: 1000 ğŸ’° | 5000 ğŸ’°
    markup.row(
        types.InlineKeyboardButton("ğŸ’° Û±,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_1000"),
        types.InlineKeyboardButton("ğŸ’° Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_5000")
    )
    
    # Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±Ù…: 15000 ğŸ’ | 20000 ğŸ’
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_15000"),
        types.InlineKeyboardButton("ğŸ’ Û²Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_20000")
    )
    
    # Ø±Ø¯ÛŒÙ Ù¾Ù†Ø¬Ù…: 50000 ğŸ’¸ | 100000 ğŸ’¸
    markup.row(
        types.InlineKeyboardButton("ğŸ’¸ ÛµÛ°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_50000"),
        types.InlineKeyboardButton("ğŸ’¸ Û±Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_100000")
    )
    
    # Ø±Ø¯ÛŒÙ Ø´Ø´Ù…: 1000000 ğŸ†
    markup.row(types.InlineKeyboardButton("ğŸ† Û±,Û°Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_1000000"))
    
    # Ø±Ø¯ÛŒÙ Ù‡ÙØªÙ…: ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± âœï¸ | Ø¨ÛŒØ´ØªØ±ÛŒÙ† â™¾ï¸
    markup.row(
        types.InlineKeyboardButton("âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"add_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±", callback_data=f"add_max_{target_id}")
    )
    
    # Ø±Ø¯ÛŒÙ Ù‡Ø´ØªÙ…: Ù„ØºÙˆ âŒ
    markup.row(types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_add"))
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    text = f"""
ğŸ”§ **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±** (Ø¯Ø³ØªØ±Ø³ÛŒ: Ù…Ø§Ù„Ú©/Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {target_name}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:**
â€¢ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ¹ØŒ Ø±ÙˆÛŒ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
â€¢ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ØŒ Â«âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
â€¢ Â«â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±Â» = Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹ Ø³Ú©Ù‡

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)



@bot.callback_query_handler(func=lambda call: call.data.startswith(('add_amount_', 'add_custom_', 'add_max_', 'cancel_add')))
def handle_add_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_add':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('add_amount_'):
        # ÙØ±Ù…Øª: add_amount_Ø¢ÛŒØ¯ÛŒ_Ù…Ù‚Ø¯Ø§Ø±
        parts = data.split('_')
        target_id = parts[2]
        amount = int(parts[3])
        
        # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        users[target_id]['coins'] += amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
âœ… **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!")
    
    elif data.startswith('add_custom_'):
        target_id = data.replace('add_custom_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'add_custom_amount',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"âœï¸ **ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡**\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('add_max_'):
        target_id = data.replace('add_max_', '')
        max_amount = 9999999999999999999999999999999999
        
        # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±
        old_amount = users[target_id].get('coins', 0)
        users[target_id]['coins'] += max_amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
â™¾ï¸ **Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {max_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ù‚Ø¯Ø§Ø± Ù…Ù…Ú©Ù† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
â™¾ï¸ **Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {max_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!")


# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'add_custom_amount')
def handle_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    amount = int(message.text)
    
    if amount <= 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯!")
        return
    
    # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    old_amount = users[target_id].get('coins', 0)
    users[target_id]['coins'] += amount
    save_data()
    
    user_data = get_user(target_id)
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    bot.send_message(
        message.chat.id,
        f"""
âœ… **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        bot.send_message(
            int(target_id),
            f"""
âœï¸ **Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass

        
                

@bot.message_handler(commands=['remove', 'rm'])
def remove_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    waiting_for_admin_action[str(message.from_user.id)] = {
        'step': 'remove_coins_target',
        'target_user_id': target_id,
        'target_name': target_name
    }
    
    # Ù…Ù†ÙˆÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ + Ø§ÛŒÙ…ÙˆØ¬ÛŒ
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: 10000 ğŸª™
    markup.row(types.InlineKeyboardButton("ğŸª™ Û±Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_10000"))
    
    # Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: 100 ğŸª™ | 500 ğŸª™
    markup.row(
        types.InlineKeyboardButton("ğŸª™ Û±Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_100"),
        types.InlineKeyboardButton("ğŸª™ ÛµÛ°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_500")
    )
    
    # Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…: 1000 ğŸ’° | 5000 ğŸ’°
    markup.row(
        types.InlineKeyboardButton("ğŸ’° Û±,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_1000"),
        types.InlineKeyboardButton("ğŸ’° Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_5000")
    )
    
    # Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±Ù…: 15000 ğŸ’ | 20000 ğŸ’
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_15000"),
        types.InlineKeyboardButton("ğŸ’ Û²Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_20000")
    )
    
    # Ø±Ø¯ÛŒÙ Ù¾Ù†Ø¬Ù…: 50000 ğŸ’¸ | 100000 ğŸ’¸
    markup.row(
        types.InlineKeyboardButton("ğŸ’¸ ÛµÛ°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_50000"),
        types.InlineKeyboardButton("ğŸ’¸ Û±Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_100000")
    )
    
    # Ø±Ø¯ÛŒÙ Ø´Ø´Ù…: 1000000 ğŸ†
    markup.row(types.InlineKeyboardButton("ğŸ† Û±,Û°Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_1000000"))
    
    # Ø±Ø¯ÛŒÙ Ù‡ÙØªÙ…: ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± âœï¸ | Ø¨ÛŒØ´ØªØ±ÛŒÙ† â™¾ï¸ | Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† âš ï¸
    markup.row(
        types.InlineKeyboardButton("âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"remove_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"remove_zero_{target_id}")
    )
    
    # Ø±Ø¯ÛŒÙ Ù‡Ø´ØªÙ…: Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ âš ï¸
    markup.row(types.InlineKeyboardButton("âš ï¸ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"negative_mode_{target_id}"))
    
    # Ø±Ø¯ÛŒÙ Ù†Ù‡Ù…: Ù„ØºÙˆ âŒ
    markup.row(types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_remove"))
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    text = f"""
ğŸ”§ **Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±** (Ø¯Ø³ØªØ±Ø³ÛŒ: Ù…Ø§Ù„Ú©/Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {target_name}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:**
â€¢ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ¹ØŒ Ø±ÙˆÛŒ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
â€¢ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ØŒ Â«âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
â€¢ Â«â™¾ï¸ ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒÂ» = Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±Ø§ ØµÙØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
â€¢ Â«âš ï¸ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒÂ» = Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ù…Ù†ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)



@bot.callback_query_handler(func=lambda call: call.data.startswith(('remove_amount_', 'remove_custom_', 'remove_zero_', 'negative_mode_', 'cancel_remove')))
def handle_remove_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_remove':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('remove_amount_'):
        # ÙØ±Ù…Øª: remove_amount_Ø¢ÛŒØ¯ÛŒ_Ù…Ù‚Ø¯Ø§Ø±
        parts = data.split('_')
        target_id = parts[2]
        amount = int(parts[3])
        
        # Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        
        if old_amount < amount:
            bot.answer_callback_query(call.id, f"âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±Ø¯! ({old_amount:,} Ø³Ú©Ù‡)")
            return
        
        users[target_id]['coins'] -= amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
âœ… **Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª!**

â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ú©Ø³Ø± Ø´Ø¯!")
    
    elif data.startswith('remove_custom_'):
        target_id = data.replace('remove_custom_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'remove_custom_amount',
            'target_user_id': target_id,
            'negative_mode': False
        }
        
        bot.send_message(
            call.message.chat.id,
            f"âœï¸ **ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø±**\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('remove_zero_'):
        target_id = data.replace('remove_zero_', '')
        
        # ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        
        if old_amount == 0:
            bot.answer_callback_query(call.id, "âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù‚Ø¨Ù„ ØµÙØ± Ø§Ø³Øª!")
            return
        
        users[target_id]['coins'] = 0
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
â™¾ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ØµÙØ± Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** Û° Ø³Ú©Ù‡

âš ï¸ **ØªÙ…Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ØµÙØ± Ø´Ø¯.**
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
â™¾ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØµÙØ± Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** Û° Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, "â™¾ï¸ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙØ± Ø´Ø¯!")
    
    elif data.startswith('negative_mode_'):
        target_id = data.replace('negative_mode_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'remove_custom_amount',
            'target_user_id': target_id,
            'negative_mode': True  # Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†
        }
        
        user_data = get_user(target_id)
        current_coins = user_data.get('coins', 0)
        
        bot.send_message(
            call.message.chat.id,
            f"""
âš ï¸ **Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ’¡ **Ù†Ø­ÙˆÙ‡ Ú©Ø§Ø±:**
â€¢ Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Û±Û°,Û°Û°Û° ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
  - Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {current_coins:,}
  - Ù¾Ø³ Ø§Ø² Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†: {current_coins - 10000:,}

ğŸ“ **Ù…Ø«Ø§Ù„:**
â€¢ Ù…ÙˆØ¬ÙˆØ¯ÛŒ: Ûµ,Û°Û°Û° Ø³Ú©Ù‡
â€¢ Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ: Û±Û°,Û°Û°Û° Ø³Ú©Ù‡
â€¢ Ù†ØªÛŒØ¬Ù‡: -Ûµ,Û°Û°Û° Ø³Ú©Ù‡

Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id, "âš ï¸ Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† ÙØ¹Ø§Ù„ Ø´Ø¯")


# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ (Ú©Ø§Ù‡Ø´ ÛŒØ§ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†)
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'remove_custom_amount')
def handle_remove_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    negative_mode = action_data.get('negative_mode', False)
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    amount = int(message.text)
    
    if amount <= 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯!")
        return
    
    old_amount = users[target_id].get('coins', 0)
    user_data = get_user(target_id)
    
    if negative_mode:
        # Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†: Ù…ÙˆØ¬ÙˆØ¯ÛŒ = Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ - Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
        users[target_id]['coins'] = old_amount - amount
        action_text = "Ù…Ù†ÙÛŒ Ø´Ø¯"
        emoji = "âš ï¸"
        description = f"Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ù†ÙÛŒ Ø´Ø¯: {old_amount:,} - {amount:,} = {users[target_id]['coins']:,}"
    else:
        # Ø­Ø§Ù„Øª Ú©Ø§Ù‡Ø´ Ø¹Ø§Ø¯ÛŒ
        if old_amount < amount:
            bot.send_message(message.chat.id, f"âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±Ø¯!\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {old_amount:,} Ø³Ú©Ù‡")
            return
        
        users[target_id]['coins'] -= amount
        action_text = "Ú©Ø³Ø± Ø´Ø¯"
        emoji = "âœ…"
        description = f"Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡: {amount:,} Ø³Ú©Ù‡"
    
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    bot.send_message(
        message.chat.id,
        f"""
{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** ({'Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†' if negative_mode else 'Ú©Ø§Ù‡Ø´ Ø¹Ø§Ø¯ÛŒ'})

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
{'â–' if negative_mode else 'â–'} **Ù…Ù‚Ø¯Ø§Ø±:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ“ **ØªÙˆØ¶ÛŒØ­:** {description}

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        if negative_mode:
            user_message = f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ù…Ù†ÙÛŒ Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
"""
        else:
            user_message = f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
"""
        
        bot.send_message(
            int(target_id),
            user_message,
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass





@bot.message_handler(commands=['set'])
def set_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    # Ù…Ù†ÙˆÛŒ Ø®ÙÙ† Ø³Øª ğŸš€
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹ ğŸ”¥
    markup.row(types.InlineKeyboardButton("ğŸš€ Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹", callback_data=f"section_info_1"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ® Û±Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_10000"),
        types.InlineKeyboardButton("ğŸ’° Û±Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_100000")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_1000000"),
        types.InlineKeyboardButton("ğŸ‘‘ Û±Û°,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_10000000")
    )
    
    # Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡ âœ¨
    markup.row(types.InlineKeyboardButton("âœ¨ Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡", callback_data=f"section_info_2"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ¯ ÛµÛ°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_500000"),
        types.InlineKeyboardButton("ğŸ”¥ Û²,ÛµÛ°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_2500000")
    )
    
    markup.row(
        types.InlineKeyboardButton("âš¡ Ûµ,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_5000000"),
        types.InlineKeyboardButton("ğŸŒŸ Û²Ûµ,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_25000000")
    )
    
    # Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡ ğŸ› ï¸
    markup.row(types.InlineKeyboardButton("ğŸ› ï¸ Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡", callback_data=f"section_info_3"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ² ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"set_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª", callback_data=f"set_max_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("âš–ï¸ ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ±", callback_data=f"set_zero_{target_id}"),
        types.InlineKeyboardButton("ğŸª Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±", callback_data=f"set_copy_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ“Š Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù†", callback_data=f"set_double_{target_id}"),
        types.InlineKeyboardButton("ğŸ“‰ Ù†ØµÙ Ú©Ø±Ø¯Ù†", callback_data=f"set_half_{target_id}")
    )
    
    # Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ ğŸ§®
    markup.row(types.InlineKeyboardButton("ğŸ§® Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ", callback_data=f"section_info_4"))
    
    markup.row(
        types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Û±Û°Ùª", callback_data=f"set_percent_{target_id}_10"),
        types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Û±Û°Ùª", callback_data=f"set_percent_{target_id}_-10")
    )
    
    markup.row(
        types.InlineKeyboardButton("âœ–ï¸ Ø¶Ø±Ø¨ Ø¯Ø± Û²", callback_data=f"set_multiply_{target_id}_2"),
        types.InlineKeyboardButton("â— ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Û²", callback_data=f"set_divide_{target_id}_2")
    )
    
    # Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª ğŸª
    markup.row(types.InlineKeyboardButton("ğŸª Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª", callback_data=f"section_info_5"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ“ˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±", callback_data=f"set_info_{target_id}"),
        types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copy_id_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ® Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ", callback_data=f"set_current_{target_id}"),
        types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_set")
    )
    
    text = f"""
ğŸ® **Ø¯Ø³ØªÙˆØ± SET - ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ù†Ø¯Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ** ğŸ”§

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±:**
â”œâ”€ ğŸ· **Ù†Ø§Ù…:** {target_name}
â”œâ”€ ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
â””â”€ ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù†:** {int((current_coins / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸš€ **Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ:**
â”œâ”€ ğŸ”¥ **Ø¨Ø®Ø´ Û±:** Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹
â”œâ”€ âœ¨ **Ø¨Ø®Ø´ Û²:** Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡  
â”œâ”€ ğŸ› ï¸ **Ø¨Ø®Ø´ Û³:** Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡
â”œâ”€ ğŸ§® **Ø¨Ø®Ø´ Û´:** Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ
â””â”€ ğŸª **Ø¨Ø®Ø´ Ûµ:** Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)


@bot.callback_query_handler(func=lambda call: call.data.startswith(('set_amount_', 'set_custom_', 'set_max_', 'set_zero_', 'set_copy_', 'set_double_', 'set_half_', 'set_percent_', 'set_multiply_', 'set_divide_', 'set_info_', 'set_current_', 'section_info_', 'copy_id_', 'cancel_set')))
def handle_set_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_set':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('section_info_'):
        section_num = data.replace('section_info_', '')
        sections = {
            '1': "ğŸ”¥ **Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹**\nÙ…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ùˆ Ø±Ø§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒØ¹",
            '2': "âœ¨ **Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡**\nÙ…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡ Ùˆ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† VIP",
            '3': "ğŸ› ï¸ **Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡**\nØ¹Ù…Ù„ÛŒØ§Øª Ø®Ø§Øµ Ùˆ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø±ÙˆÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ",
            '4': "ğŸ§® **Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ**\nØ§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ Ø±ÙˆÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ",
            '5': "ğŸª **Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª**\nØ§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ"
        }
        
        bot.answer_callback_query(call.id, sections.get(section_num, "âŒ Ø¨Ø®Ø´ Ù†Ø§Ù…Ø¹ØªØ¨Ø±"), show_alert=True)
        return
    
    elif data.startswith('copy_id_'):
        target_id = data.replace('copy_id_', '')
        bot.send_message(call.message.chat.id, f"ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±:**\n`{target_id}`", parse_mode='Markdown')
        bot.answer_callback_query(call.id, "âœ… Ø¢ÛŒØ¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯")
        return
    
    elif data.startswith('set_info_'):
        target_id = data.replace('set_info_', '')
        user_data = get_user(target_id)
        
        info_text = f"""
ğŸ“Š **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±**

ğŸ‘¤ **Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ:**
â”œâ”€ ğŸ· **Ù†Ø§Ù…:** {user_data['first_name']}
â”œâ”€ ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
â”œâ”€ ğŸ“± **ÛŒÙˆØ²Ø±Ù†ÛŒÙ…:** @{user_data.get('username', '---')}
â””â”€ ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ:** {user_data.get('coins', 0):,} Ø³Ú©Ù‡

ğŸ“ˆ **Ø¢Ù…Ø§Ø± Ù…Ø§Ù„ÛŒ:**
â”œâ”€ ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù†:** {int((user_data.get('coins', 0) / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
â”œâ”€ ğŸ‘¥ **ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØª:** {user_data.get('referral_count', 0)} Ù†ÙØ±
â””â”€ ğŸ¯ **Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø¯Ø¹ÙˆØª:** {user_data.get('total_earned', 0):,} Ø³Ú©Ù‡

ğŸ“… **ÙˆØ¶Ø¹ÛŒØª:**
â”œâ”€ ğŸ‘‘ **Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±:** {'Ø§Ø¯Ù…ÛŒÙ† âœ…' if is_admin(int(target_id)) else 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ ğŸ‘¤'}
â”œâ”€ ğŸ”„ **Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª:** {'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† âœ…'}
â””â”€ ğŸ“Š **Ø±ØªØ¨Ù‡:** {'Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...'}
"""
        
        bot.send_message(call.message.chat.id, info_text, parse_mode='Markdown')
        bot.answer_callback_query(call.id, "ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
        return
    
    # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
    target_id = None
    for prefix in ['set_amount_', 'set_custom_', 'set_max_', 'set_zero_', 'set_copy_', 'set_double_', 'set_half_', 'set_percent_', 'set_multiply_', 'set_divide_', 'set_current_']:
        if data.startswith(prefix):
            target_id = data.replace(prefix, '').split('_')[0] if '_' in data.replace(prefix, '') else data.replace(prefix, '')
            break
    
    if not target_id:
        bot.answer_callback_query(call.id, "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±")
        return
    
    user_data = get_user(target_id)
    old_amount = user_data.get('coins', 0)
    
    # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ù†ÙˆØ§Ø¹ Ø¹Ù…Ù„ÛŒØ§Øª
    if data.startswith('set_amount_'):
        # ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ù…Ø´Ø®Øµ
        amount = int(data.split('_')[2])
        new_amount = amount
        
        operation_text = f"ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ {amount:,} Ø³Ú©Ù‡"
        emoji = "ğŸ¯"
    
    elif data.startswith('set_max_'):
        # ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª
        new_amount = 9999999999999999999999999999999999
        operation_text = "ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª â™¾ï¸"
        emoji = "â™¾ï¸"
    
    elif data.startswith('set_zero_'):
        # ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ±
        new_amount = 0
        operation_text = "ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ± âš–ï¸"
        emoji = "âš–ï¸"
    
    elif data.startswith('set_current_'):
        # Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ
        new_amount = old_amount
        operation_text = "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ"
        emoji = "ğŸ®"
    
    elif data.startswith('set_double_'):
        # Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù†
        new_amount = old_amount * 2
        operation_text = f"Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù† ({old_amount:,} Ã— Û²)"
        emoji = "ğŸ“Š"
    
    elif data.startswith('set_half_'):
        # Ù†ØµÙ Ú©Ø±Ø¯Ù†
        new_amount = old_amount // 2
        operation_text = f"Ù†ØµÙ Ú©Ø±Ø¯Ù† ({old_amount:,} Ã· Û²)"
        emoji = "ğŸ“‰"
    
    elif data.startswith('set_percent_'):
        # Ø¯Ø±ØµØ¯ÛŒ
        percent = int(data.split('_')[2])
        if percent > 0:
            new_amount = old_amount + (old_amount * percent // 100)
            operation_text = f"Ø§ÙØ²Ø§ÛŒØ´ {percent}Ùª"
            emoji = "â•"
        else:
            new_amount = old_amount + (old_amount * percent // 100)  # Ø¯Ø±ØµØ¯ Ù…Ù†ÙÛŒ
            operation_text = f"Ú©Ø§Ù‡Ø´ {abs(percent)}Ùª"
            emoji = "â–"
    
    elif data.startswith('set_multiply_'):
        # Ø¶Ø±Ø¨ Ø¯Ø±
        multiplier = int(data.split('_')[2])
        new_amount = old_amount * multiplier
        operation_text = f"Ø¶Ø±Ø¨ Ø¯Ø± {multiplier} ({old_amount:,} Ã— {multiplier})"
        emoji = "âœ–ï¸"
    
    elif data.startswith('set_divide_'):
        # ØªÙ‚Ø³ÛŒÙ… Ø¨Ø±
        divisor = int(data.split('_')[2])
        if divisor == 0:
            bot.answer_callback_query(call.id, "âŒ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± ØµÙØ± Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª!")
            return
        new_amount = old_amount // divisor
        operation_text = f"ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± {divisor} ({old_amount:,} Ã· {divisor})"
        emoji = "â—"
    
    elif data.startswith('set_custom_'):
        # Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'set_custom_amount',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"""
ğŸ² **ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡

ğŸ“ **Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:**
(Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('set_copy_'):
        # Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'set_copy_user',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"""
ğŸª **Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡

ğŸ“ **Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ ÛŒØ§ @ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒØ§Ø´ Ú©Ù¾ÛŒ Ø´ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:**
Ù…Ø«Ø§Ù„: `123456789` ÛŒØ§ `@username`
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
        return
    
    else:
        bot.answer_callback_query(call.id, "âŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±")
        return
    
    # Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ù…Ù†Ùˆ
    try:
        bot.delete_message(call.message.chat.id, call.message.message_id)
    except:
        pass
    
    # Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø¨Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø®ÙÙ†
    bot.send_message(
        call.message.chat.id,
        f"""
{emoji} **âœ… Ø¹Ù…Ù„ÛŒØ§Øª SET Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª:** {operation_text}

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ù‚Ø¨Ù„ÛŒ:** {int((old_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ø¬Ø¯ÛŒØ¯:** {int((new_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {call.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        if change != 0:
            user_message = f"""
ğŸ® **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!**

{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª:** {operation_text}

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
"""
        else:
            user_message = f"""
âš–ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø§Ù†Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯**

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
"""
        
        bot.send_message(
            int(target_id),
            user_message,
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass
    
    bot.answer_callback_query(call.id, f"{emoji} Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!")



# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'set_custom_amount')
def handle_set_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    new_amount = int(message.text)
    
    if new_amount < 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯!")
        return
    
    old_amount = users[target_id].get('coins', 0)
    user_data = get_user(target_id)
    
    # Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    bot.send_message(
        message.chat.id,
        f"""
ğŸ² **âœ… ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ù‚Ø¨Ù„ÛŒ:** {int((old_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ø¬Ø¯ÛŒØ¯:** {int((new_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        bot.send_message(
            int(target_id),
            f"""
ğŸ² **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!** (Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡)

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass



# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'set_copy_user')
def handle_set_copy_user(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    identifier = message.text.strip().replace('@', '')
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹
    source_user_id = None
    source_user_data = None
    
    if identifier.isdigit():
        # Ø§Ú¯Ø± Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø§Ø³Øª
        if identifier in users:
            source_user_id = identifier
            source_user_data = get_user(identifier)
    else:
        # Ø§Ú¯Ø± ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø³Øª
        for uid, user_data in users.items():
            if user_data.get('username') == identifier:
                source_user_id = uid
                source_user_data = user_data
                break
    
    if not source_user_id:
        bot.send_message(message.chat.id, "âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!\nÙ„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢ÛŒØ¯ÛŒ ÛŒØ§ @ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    # Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    target_user_data = get_user(target_id)
    old_amount = target_user_data.get('coins', 0)
    new_amount = source_user_data.get('coins', 0)
    
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    bot.send_message(
        message.chat.id,
        f"""
ğŸª **âœ… Ú©Ù¾ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯:** {target_user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ù…Ù‚ØµØ¯:** `{target_id}`

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹:** {source_user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ù…Ù†Ø¨Ø¹:** `{source_user_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’¡ **ØªÙˆØ¶ÛŒØ­:** Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± {source_user_data['first_name']} Ú©Ù¾ÛŒ Ø´Ø¯.

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯
    try:
        bot.send_message(
            int(target_id),
            f"""
ğŸª **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ù¾ÛŒ Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’¡ **Ø§Ø² Ú©Ø§Ø±Ø¨Ø±:** {source_user_data['first_name']} Ú©Ù¾ÛŒ Ø´Ø¯.

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
    try:
        bot.send_message(
            int(source_user_id),
            f"""
â„¹ï¸ **Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡:** Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ† Ú©Ù¾ÛŒ Ø´Ø¯!

ğŸ‘¤ **Ú©Ù¾ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ:** {target_user_data['first_name']}
ğŸ’° **Ù…Ù‚Ø¯Ø§Ø± Ú©Ù¾ÛŒ Ø´Ø¯Ù‡:** {new_amount:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(source_user_id)) else get_main_keyboard()
        )
    except:
        pass




@bot.message_handler(commands=['add'])
def add_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    waiting_for_admin_action[str(message.from_user.id)] = {
        'step': 'add_coins_target',
        'target_user_id': target_id,
        'target_name': target_name
    }
    
    # Ù…Ù†ÙˆÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ + Ø§ÛŒÙ…ÙˆØ¬ÛŒ
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: 10000 ğŸª™
    markup.row(types.InlineKeyboardButton("ğŸª™ Û±Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_10000"))
    
    # Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: 100 ğŸª™ | 500 ğŸª™
    markup.row(
        types.InlineKeyboardButton("ğŸª™ Û±Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_100"),
        types.InlineKeyboardButton("ğŸª™ ÛµÛ°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_500")
    )
    
    # Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…: 1000 ğŸ’° | 5000 ğŸ’°
    markup.row(
        types.InlineKeyboardButton("ğŸ’° Û±,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_1000"),
        types.InlineKeyboardButton("ğŸ’° Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_5000")
    )
    
    # Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±Ù…: 15000 ğŸ’ | 20000 ğŸ’
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_15000"),
        types.InlineKeyboardButton("ğŸ’ Û²Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_20000")
    )
    
    # Ø±Ø¯ÛŒÙ Ù¾Ù†Ø¬Ù…: 50000 ğŸ’¸ | 100000 ğŸ’¸
    markup.row(
        types.InlineKeyboardButton("ğŸ’¸ ÛµÛ°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_50000"),
        types.InlineKeyboardButton("ğŸ’¸ Û±Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_100000")
    )
    
    # Ø±Ø¯ÛŒÙ Ø´Ø´Ù…: 1000000 ğŸ†
    markup.row(types.InlineKeyboardButton("ğŸ† Û±,Û°Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"add_amount_{target_id}_1000000"))
    
    # Ø±Ø¯ÛŒÙ Ù‡ÙØªÙ…: ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± âœï¸ | Ø¨ÛŒØ´ØªØ±ÛŒÙ† â™¾ï¸
    markup.row(
        types.InlineKeyboardButton("âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"add_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±", callback_data=f"add_max_{target_id}")
    )
    
    # Ø±Ø¯ÛŒÙ Ù‡Ø´ØªÙ…: Ù„ØºÙˆ âŒ
    markup.row(types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_add"))
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    text = f"""
ğŸ”§ **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±** (Ø¯Ø³ØªØ±Ø³ÛŒ: Ù…Ø§Ù„Ú©/Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {target_name}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:**
â€¢ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ¹ØŒ Ø±ÙˆÛŒ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
â€¢ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ØŒ Â«âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
â€¢ Â«â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±Â» = Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹,Û¹Û¹Û¹ Ø³Ú©Ù‡

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)


@bot.callback_query_handler(func=lambda call: call.data.startswith(('add_amount_', 'add_custom_', 'add_max_', 'cancel_add')))
def handle_add_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_add':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('add_amount_'):
        # ÙØ±Ù…Øª: add_amount_Ø¢ÛŒØ¯ÛŒ_Ù…Ù‚Ø¯Ø§Ø±
        parts = data.split('_')
        target_id = parts[2]
        amount = int(parts[3])
        
        # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        users[target_id]['coins'] += amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
âœ… **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!")
    
    elif data.startswith('add_custom_'):
        target_id = data.replace('add_custom_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'add_custom_amount',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"âœï¸ **ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡**\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('add_max_'):
        target_id = data.replace('add_max_', '')
        max_amount = 9999999999999999999999999999999999
        
        # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø±
        old_amount = users[target_id].get('coins', 0)
        users[target_id]['coins'] += max_amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
â™¾ï¸ **Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {max_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ù‚Ø¯Ø§Ø± Ù…Ù…Ú©Ù† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
â™¾ï¸ **Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {max_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"â™¾ï¸ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!")


# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'add_custom_amount')
def handle_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    amount = int(message.text)
    
    if amount <= 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯!")
        return
    
    # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    old_amount = users[target_id].get('coins', 0)
    users[target_id]['coins'] += amount
    save_data()
    
    user_data = get_user(target_id)
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    bot.send_message(
        message.chat.id,
        f"""
âœ… **Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        bot.send_message(
            int(target_id),
            f"""
âœï¸ **Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!**

â• **Ù…Ù‚Ø¯Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass




@bot.message_handler(commands=['set'])
def set_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    # Ù…Ù†ÙˆÛŒ Ø®ÙÙ† Ø³Øª ğŸš€
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹ ğŸ”¥
    markup.row(types.InlineKeyboardButton("ğŸš€ Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹", callback_data=f"section_info_1"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ® Û±Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_10000"),
        types.InlineKeyboardButton("ğŸ’° Û±Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_100000")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_1000000"),
        types.InlineKeyboardButton("ğŸ‘‘ Û±Û°,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_10000000")
    )
    
    # Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡ âœ¨
    markup.row(types.InlineKeyboardButton("âœ¨ Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡", callback_data=f"section_info_2"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ¯ ÛµÛ°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_500000"),
        types.InlineKeyboardButton("ğŸ”¥ Û²,ÛµÛ°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_2500000")
    )
    
    markup.row(
        types.InlineKeyboardButton("âš¡ Ûµ,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_5000000"),
        types.InlineKeyboardButton("ğŸŒŸ Û²Ûµ,Û°Û°Û°,Û°Û°Û°", callback_data=f"set_amount_{target_id}_25000000")
    )
    
    # Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡ ğŸ› ï¸
    markup.row(types.InlineKeyboardButton("ğŸ› ï¸ Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡", callback_data=f"section_info_3"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ² ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"set_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª", callback_data=f"set_max_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("âš–ï¸ ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ±", callback_data=f"set_zero_{target_id}"),
        types.InlineKeyboardButton("ğŸª Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±", callback_data=f"set_copy_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ“Š Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù†", callback_data=f"set_double_{target_id}"),
        types.InlineKeyboardButton("ğŸ“‰ Ù†ØµÙ Ú©Ø±Ø¯Ù†", callback_data=f"set_half_{target_id}")
    )
    
    # Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ ğŸ§®
    markup.row(types.InlineKeyboardButton("ğŸ§® Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ", callback_data=f"section_info_4"))
    
    markup.row(
        types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Û±Û°Ùª", callback_data=f"set_percent_{target_id}_10"),
        types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Û±Û°Ùª", callback_data=f"set_percent_{target_id}_-10")
    )
    
    markup.row(
        types.InlineKeyboardButton("âœ–ï¸ Ø¶Ø±Ø¨ Ø¯Ø± Û²", callback_data=f"set_multiply_{target_id}_2"),
        types.InlineKeyboardButton("â— ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Û²", callback_data=f"set_divide_{target_id}_2")
    )
    
    # Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª ğŸª
    markup.row(types.InlineKeyboardButton("ğŸª Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª", callback_data=f"section_info_5"))
    
    markup.row(
        types.InlineKeyboardButton("ğŸ“ˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±", callback_data=f"set_info_{target_id}"),
        types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copy_id_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ® Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ", callback_data=f"set_current_{target_id}"),
        types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_set")
    )
    
    text = f"""
ğŸ® **Ø¯Ø³ØªÙˆØ± SET - ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ù†Ø¯Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ** ğŸ”§

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±:**
â”œâ”€ ğŸ· **Ù†Ø§Ù…:** {target_name}
â”œâ”€ ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
â””â”€ ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù†:** {int((current_coins / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸš€ **Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ:**
â”œâ”€ ğŸ”¥ **Ø¨Ø®Ø´ Û±:** Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹
â”œâ”€ âœ¨ **Ø¨Ø®Ø´ Û²:** Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡  
â”œâ”€ ğŸ› ï¸ **Ø¨Ø®Ø´ Û³:** Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡
â”œâ”€ ğŸ§® **Ø¨Ø®Ø´ Û´:** Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ
â””â”€ ğŸª **Ø¨Ø®Ø´ Ûµ:** Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)



@bot.callback_query_handler(func=lambda call: call.data.startswith(('set_amount_', 'set_custom_', 'set_max_', 'set_zero_', 'set_copy_', 'set_double_', 'set_half_', 'set_percent_', 'set_multiply_', 'set_divide_', 'set_info_', 'set_current_', 'section_info_', 'copy_id_', 'cancel_set')))
def handle_set_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_set':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('section_info_'):
        section_num = data.replace('section_info_', '')
        sections = {
            '1': "ğŸ”¥ **Ø¨Ø®Ø´ Û±: Ù…Ù‚Ø§Ø¯ÛŒØ± Ø³Ø±ÛŒØ¹**\nÙ…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ùˆ Ø±Ø§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒØ¹",
            '2': "âœ¨ **Ø¨Ø®Ø´ Û²: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡**\nÙ…Ù‚Ø§Ø¯ÛŒØ± ÙˆÛŒÚ˜Ù‡ Ùˆ Ø®Ø§Øµ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† VIP",
            '3': "ğŸ› ï¸ **Ø¨Ø®Ø´ Û³: Ø¹Ù…Ù„ÛŒØ§Øª ÙˆÛŒÚ˜Ù‡**\nØ¹Ù…Ù„ÛŒØ§Øª Ø®Ø§Øµ Ùˆ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø±ÙˆÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ",
            '4': "ğŸ§® **Ø¨Ø®Ø´ Û´: Ø§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ**\nØ§Ø¹Ù…Ø§Ù„ Ø±ÛŒØ§Ø¶ÛŒ Ø±ÙˆÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ",
            '5': "ğŸª **Ø¨Ø®Ø´ Ûµ: Ù…Ø¯ÛŒØ±ÛŒØª**\nØ§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ"
        }
        
        bot.answer_callback_query(call.id, sections.get(section_num, "âŒ Ø¨Ø®Ø´ Ù†Ø§Ù…Ø¹ØªØ¨Ø±"), show_alert=True)
        return
    
    elif data.startswith('copy_id_'):
        target_id = data.replace('copy_id_', '')
        bot.send_message(call.message.chat.id, f"ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±:**\n`{target_id}`", parse_mode='Markdown')
        bot.answer_callback_query(call.id, "âœ… Ø¢ÛŒØ¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯")
        return
    
    elif data.startswith('set_info_'):
        target_id = data.replace('set_info_', '')
        user_data = get_user(target_id)
        
        info_text = f"""
ğŸ“Š **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±**

ğŸ‘¤ **Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ:**
â”œâ”€ ğŸ· **Ù†Ø§Ù…:** {user_data['first_name']}
â”œâ”€ ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
â”œâ”€ ğŸ“± **ÛŒÙˆØ²Ø±Ù†ÛŒÙ…:** @{user_data.get('username', '---')}
â””â”€ ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ:** {user_data.get('coins', 0):,} Ø³Ú©Ù‡

ğŸ“ˆ **Ø¢Ù…Ø§Ø± Ù…Ø§Ù„ÛŒ:**
â”œâ”€ ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù†:** {int((user_data.get('coins', 0) / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
â”œâ”€ ğŸ‘¥ **ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØª:** {user_data.get('referral_count', 0)} Ù†ÙØ±
â””â”€ ğŸ¯ **Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø¯Ø¹ÙˆØª:** {user_data.get('total_earned', 0):,} Ø³Ú©Ù‡

ğŸ“… **ÙˆØ¶Ø¹ÛŒØª:**
â”œâ”€ ğŸ‘‘ **Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±:** {'Ø§Ø¯Ù…ÛŒÙ† âœ…' if is_admin(int(target_id)) else 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ ğŸ‘¤'}
â”œâ”€ ğŸ”„ **Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª:** {'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† âœ…'}
â””â”€ ğŸ“Š **Ø±ØªØ¨Ù‡:** {'Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...'}
"""
        
        bot.send_message(call.message.chat.id, info_text, parse_mode='Markdown')
        bot.answer_callback_query(call.id, "ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
        return
    
    # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
    target_id = None
    for prefix in ['set_amount_', 'set_custom_', 'set_max_', 'set_zero_', 'set_copy_', 'set_double_', 'set_half_', 'set_percent_', 'set_multiply_', 'set_divide_', 'set_current_']:
        if data.startswith(prefix):
            target_id = data.replace(prefix, '').split('_')[0] if '_' in data.replace(prefix, '') else data.replace(prefix, '')
            break
    
    if not target_id:
        bot.answer_callback_query(call.id, "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ø§Ø±Ø¨Ø±")
        return
    
    user_data = get_user(target_id)
    old_amount = user_data.get('coins', 0)
    
    # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ù†ÙˆØ§Ø¹ Ø¹Ù…Ù„ÛŒØ§Øª
    if data.startswith('set_amount_'):
        # ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ù…Ø´Ø®Øµ
        amount = int(data.split('_')[2])
        new_amount = amount
        
        operation_text = f"ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ {amount:,} Ø³Ú©Ù‡"
        emoji = "ğŸ¯"
    
    elif data.startswith('set_max_'):
        # ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª
        new_amount = 9999999999999999999999999999999999
        operation_text = "ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª â™¾ï¸"
        emoji = "â™¾ï¸"
    
    elif data.startswith('set_zero_'):
        # ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ±
        new_amount = 0
        operation_text = "ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒ ØµÙØ± âš–ï¸"
        emoji = "âš–ï¸"
    
    elif data.startswith('set_current_'):
        # Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ
        new_amount = old_amount
        operation_text = "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ"
        emoji = "ğŸ®"
    
    elif data.startswith('set_double_'):
        # Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù†
        new_amount = old_amount * 2
        operation_text = f"Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ú©Ø±Ø¯Ù† ({old_amount:,} Ã— Û²)"
        emoji = "ğŸ“Š"
    
    elif data.startswith('set_half_'):
        # Ù†ØµÙ Ú©Ø±Ø¯Ù†
        new_amount = old_amount // 2
        operation_text = f"Ù†ØµÙ Ú©Ø±Ø¯Ù† ({old_amount:,} Ã· Û²)"
        emoji = "ğŸ“‰"
    
    elif data.startswith('set_percent_'):
        # Ø¯Ø±ØµØ¯ÛŒ
        percent = int(data.split('_')[2])
        if percent > 0:
            new_amount = old_amount + (old_amount * percent // 100)
            operation_text = f"Ø§ÙØ²Ø§ÛŒØ´ {percent}Ùª"
            emoji = "â•"
        else:
            new_amount = old_amount + (old_amount * percent // 100)  # Ø¯Ø±ØµØ¯ Ù…Ù†ÙÛŒ
            operation_text = f"Ú©Ø§Ù‡Ø´ {abs(percent)}Ùª"
            emoji = "â–"
    
    elif data.startswith('set_multiply_'):
        # Ø¶Ø±Ø¨ Ø¯Ø±
        multiplier = int(data.split('_')[2])
        new_amount = old_amount * multiplier
        operation_text = f"Ø¶Ø±Ø¨ Ø¯Ø± {multiplier} ({old_amount:,} Ã— {multiplier})"
        emoji = "âœ–ï¸"
    
    elif data.startswith('set_divide_'):
        # ØªÙ‚Ø³ÛŒÙ… Ø¨Ø±
        divisor = int(data.split('_')[2])
        if divisor == 0:
            bot.answer_callback_query(call.id, "âŒ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± ØµÙØ± Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª!")
            return
        new_amount = old_amount // divisor
        operation_text = f"ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± {divisor} ({old_amount:,} Ã· {divisor})"
        emoji = "â—"
    
    elif data.startswith('set_custom_'):
        # Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'set_custom_amount',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"""
ğŸ² **ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡

ğŸ“ **Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:**
(Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('set_copy_'):
        # Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'set_copy_user',
            'target_user_id': target_id
        }
        
        bot.send_message(
            call.message.chat.id,
            f"""
ğŸª **Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡

ğŸ“ **Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ ÛŒØ§ @ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒØ§Ø´ Ú©Ù¾ÛŒ Ø´ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:**
Ù…Ø«Ø§Ù„: `123456789` ÛŒØ§ `@username`
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
        return
    
    else:
        bot.answer_callback_query(call.id, "âŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±")
        return
    
    # Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ù…Ù†Ùˆ
    try:
        bot.delete_message(call.message.chat.id, call.message.message_id)
    except:
        pass
    
    # Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø¨Ø§ Ø·Ø±Ø§Ø­ÛŒ Ø®ÙÙ†
    bot.send_message(
        call.message.chat.id,
        f"""
{emoji} **âœ… Ø¹Ù…Ù„ÛŒØ§Øª SET Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª:** {operation_text}

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ù‚Ø¨Ù„ÛŒ:** {int((old_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ø¬Ø¯ÛŒØ¯:** {int((new_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {call.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        if change != 0:
            user_message = f"""
ğŸ® **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!**

{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª:** {operation_text}

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
"""
        else:
            user_message = f"""
âš–ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ù…Ø§Ù†Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯**

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
"""
        
        bot.send_message(
            int(target_id),
            user_message,
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass
    
    bot.answer_callback_query(call.id, f"{emoji} Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!")


# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'set_custom_amount')
def handle_set_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    new_amount = int(message.text)
    
    if new_amount < 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯!")
        return
    
    old_amount = users[target_id].get('coins', 0)
    user_data = get_user(target_id)
    
    # Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    bot.send_message(
        message.chat.id,
        f"""
ğŸ² **âœ… ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ù‚Ø¨Ù„ÛŒ:** {int((old_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
ğŸ’µ **Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù† Ø¬Ø¯ÛŒØ¯:** {int((new_amount / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        bot.send_message(
            int(target_id),
            f"""
ğŸ² **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!** (Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡)

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass



# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ø±
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'set_copy_user')
def handle_set_copy_user(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    
    identifier = message.text.strip().replace('@', '')
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹
    source_user_id = None
    source_user_data = None
    
    if identifier.isdigit():
        # Ø§Ú¯Ø± Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø§Ø³Øª
        if identifier in users:
            source_user_id = identifier
            source_user_data = get_user(identifier)
    else:
        # Ø§Ú¯Ø± ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø³Øª
        for uid, user_data in users.items():
            if user_data.get('username') == identifier:
                source_user_id = uid
                source_user_data = user_data
                break
    
    if not source_user_id:
        bot.send_message(message.chat.id, "âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!\nÙ„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢ÛŒØ¯ÛŒ ÛŒØ§ @ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    # Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    target_user_data = get_user(target_id)
    old_amount = target_user_data.get('coins', 0)
    new_amount = source_user_data.get('coins', 0)
    
    users[target_id]['coins'] = new_amount
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    change = new_amount - old_amount
    change_text = f"{change:+,}" if change != 0 else "Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±"
    change_emoji = "â•" if change > 0 else "â–" if change < 0 else "âš–ï¸"
    
    bot.send_message(
        message.chat.id,
        f"""
ğŸª **âœ… Ú©Ù¾ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯:** {target_user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ù…Ù‚ØµØ¯:** `{target_id}`

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹:** {source_user_data['first_name']}
ğŸ”¢ **Ø¢ÛŒØ¯ÛŒ Ù…Ù†Ø¨Ø¹:** `{source_user_id}`

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’¡ **ØªÙˆØ¶ÛŒØ­:** Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± {source_user_data['first_name']} Ú©Ù¾ÛŒ Ø´Ø¯.

ğŸ‘‘ **Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯
    try:
        bot.send_message(
            int(target_id),
            f"""
ğŸª **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ù¾ÛŒ Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {new_amount:,} Ø³Ú©Ù‡

{change_emoji} **ØªØºÛŒÛŒØ±:** {change_text} Ø³Ú©Ù‡

ğŸ’¡ **Ø§Ø² Ú©Ø§Ø±Ø¨Ø±:** {source_user_data['first_name']} Ú©Ù¾ÛŒ Ø´Ø¯.

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù†Ø¨Ø¹ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
    try:
        bot.send_message(
            int(source_user_id),
            f"""
â„¹ï¸ **Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡:** Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ† Ú©Ù¾ÛŒ Ø´Ø¯!

ğŸ‘¤ **Ú©Ù¾ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ:** {target_user_data['first_name']}
ğŸ’° **Ù…Ù‚Ø¯Ø§Ø± Ú©Ù¾ÛŒ Ø´Ø¯Ù‡:** {new_amount:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
            reply_markup=get_admin_keyboard() if is_admin(int(source_user_id)) else get_main_keyboard()
        )
    except:
        pass





@bot.message_handler(commands=['remove', 'rm'])
def remove_coins_menu(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    target_name = target_user.first_name or "Ú©Ø§Ø±Ø¨Ø±"
    
    # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ
    waiting_for_admin_action[str(message.from_user.id)] = {
        'step': 'remove_coins_target',
        'target_user_id': target_id,
        'target_name': target_name
    }
    
    # Ù…Ù†ÙˆÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ + Ø§ÛŒÙ…ÙˆØ¬ÛŒ
    markup = types.InlineKeyboardMarkup(row_width=2)
    
    # Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: 10000 ğŸª™
    markup.row(types.InlineKeyboardButton("ğŸª™ Û±Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_10000"))
    
    # Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: 100 ğŸª™ | 500 ğŸª™
    markup.row(
        types.InlineKeyboardButton("ğŸª™ Û±Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_100"),
        types.InlineKeyboardButton("ğŸª™ ÛµÛ°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_500")
    )
    
    # Ø±Ø¯ÛŒÙ Ø³ÙˆÙ…: 1000 ğŸ’° | 5000 ğŸ’°
    markup.row(
        types.InlineKeyboardButton("ğŸ’° Û±,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_1000"),
        types.InlineKeyboardButton("ğŸ’° Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_5000")
    )
    
    # Ø±Ø¯ÛŒÙ Ú†Ù‡Ø§Ø±Ù…: 15000 ğŸ’ | 20000 ğŸ’
    markup.row(
        types.InlineKeyboardButton("ğŸ’ Û±Ûµ,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_15000"),
        types.InlineKeyboardButton("ğŸ’ Û²Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_20000")
    )
    
    # Ø±Ø¯ÛŒÙ Ù¾Ù†Ø¬Ù…: 50000 ğŸ’¸ | 100000 ğŸ’¸
    markup.row(
        types.InlineKeyboardButton("ğŸ’¸ ÛµÛ°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_50000"),
        types.InlineKeyboardButton("ğŸ’¸ Û±Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_100000")
    )
    
    # Ø±Ø¯ÛŒÙ Ø´Ø´Ù…: 1000000 ğŸ†
    markup.row(types.InlineKeyboardButton("ğŸ† Û±,Û°Û°Û°,Û°Û°Û° Ø³Ú©Ù‡", callback_data=f"remove_amount_{target_id}_1000000"))
    
    # Ø±Ø¯ÛŒÙ Ù‡ÙØªÙ…: ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± âœï¸ | Ø¨ÛŒØ´ØªØ±ÛŒÙ† â™¾ï¸ | Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† âš ï¸
    markup.row(
        types.InlineKeyboardButton("âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"remove_custom_{target_id}"),
        types.InlineKeyboardButton("â™¾ï¸ ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"remove_zero_{target_id}")
    )
    
    # Ø±Ø¯ÛŒÙ Ù‡Ø´ØªÙ…: Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ âš ï¸
    markup.row(types.InlineKeyboardButton("âš ï¸ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"negative_mode_{target_id}"))
    
    # Ø±Ø¯ÛŒÙ Ù†Ù‡Ù…: Ù„ØºÙˆ âŒ
    markup.row(types.InlineKeyboardButton("âŒ Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª", callback_data="cancel_remove"))
    
    user_data = get_user(target_id)
    current_coins = user_data.get('coins', 0)
    
    text = f"""
ğŸ”§ **Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±** (Ø¯Ø³ØªØ±Ø³ÛŒ: Ù…Ø§Ù„Ú©/Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {target_name}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ“Š **Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ:**
â€¢ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ¹ØŒ Ø±ÙˆÛŒ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
â€¢ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ØŒ Â«âœï¸ ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
â€¢ Â«â™¾ï¸ ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒÂ» = Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø±Ø§ ØµÙØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
â€¢ Â«âš ï¸ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒÂ» = Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ù…Ù†ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

âš ï¸ **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· ØªÙˆØ³Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.
"""
    
    bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)




@bot.callback_query_handler(func=lambda call: call.data.startswith(('remove_amount_', 'remove_custom_', 'remove_zero_', 'negative_mode_', 'cancel_remove')))
def handle_remove_buttons(call):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ - ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    data = call.data
    
    if data == 'cancel_remove':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('remove_amount_'):
        # ÙØ±Ù…Øª: remove_amount_Ø¢ÛŒØ¯ÛŒ_Ù…Ù‚Ø¯Ø§Ø±
        parts = data.split('_')
        target_id = parts[2]
        amount = int(parts[3])
        
        # Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        
        if old_amount < amount:
            bot.answer_callback_query(call.id, f"âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±Ø¯! ({old_amount:,} Ø³Ú©Ù‡)")
            return
        
        users[target_id]['coins'] -= amount
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
âœ… **Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** (ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†)

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª!**

â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ú©Ø³Ø± Ø´Ø¯!")
    
    elif data.startswith('remove_custom_'):
        target_id = data.replace('remove_custom_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'remove_custom_amount',
            'target_user_id': target_id,
            'negative_mode': False
        }
        
        bot.send_message(
            call.message.chat.id,
            f"âœï¸ **ØªØ¹ÛŒÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø±**\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('remove_zero_'):
        target_id = data.replace('remove_zero_', '')
        
        # ØµÙØ± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        old_amount = users[target_id].get('coins', 0)
        
        if old_amount == 0:
            bot.answer_callback_query(call.id, "âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù‚Ø¨Ù„ ØµÙØ± Ø§Ø³Øª!")
            return
        
        users[target_id]['coins'] = 0
        save_data()
        
        user_data = get_user(target_id)
        
        # Ø­Ø°Ù Ù…Ù†Ùˆ
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            pass
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"""
â™¾ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ØµÙØ± Ø´Ø¯!**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** Û° Ø³Ú©Ù‡

âš ï¸ **ØªÙ…Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ØµÙØ± Ø´Ø¯.**
""",
            parse_mode='Markdown'
        )
        
        # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        try:
            bot.send_message(
                int(target_id),
                f"""
â™¾ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØµÙØ± Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** Û° Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {call.from_user.first_name}
""",
                reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, "â™¾ï¸ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙØ± Ø´Ø¯!")
    
    elif data.startswith('negative_mode_'):
        target_id = data.replace('negative_mode_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'remove_custom_amount',
            'target_user_id': target_id,
            'negative_mode': True  # Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†
        }
        
        user_data = get_user(target_id)
        current_coins = user_data.get('coins', 0)
        
        bot.send_message(
            call.message.chat.id,
            f"""
âš ï¸ **Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ**

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ:** {current_coins:,} Ø³Ú©Ù‡

ğŸ’¡ **Ù†Ø­ÙˆÙ‡ Ú©Ø§Ø±:**
â€¢ Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Û±Û°,Û°Û°Û° ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
  - Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {current_coins:,}
  - Ù¾Ø³ Ø§Ø² Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†: {current_coins - 10000:,}

ğŸ“ **Ù…Ø«Ø§Ù„:**
â€¢ Ù…ÙˆØ¬ÙˆØ¯ÛŒ: Ûµ,Û°Û°Û° Ø³Ú©Ù‡
â€¢ Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ: Û±Û°,Û°Û°Û° Ø³Ú©Ù‡
â€¢ Ù†ØªÛŒØ¬Ù‡: -Ûµ,Û°Û°Û° Ø³Ú©Ù‡

Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:
""",
            parse_mode='Markdown'
        )
        bot.answer_callback_query(call.id, "âš ï¸ Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù† ÙØ¹Ø§Ù„ Ø´Ø¯")


# Ù‡Ù†Ø¯Ù„Ø± Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ (Ú©Ø§Ù‡Ø´ ÛŒØ§ Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†)
@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action and waiting_for_admin_action[str(m.from_user.id)]['step'] == 'remove_custom_amount')
def handle_remove_custom_amount(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    target_id = action_data['target_user_id']
    negative_mode = action_data.get('negative_mode', False)
    
    if not message.text.isdigit():
        bot.send_message(message.chat.id, "âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        return
    
    amount = int(message.text)
    
    if amount <= 0:
        bot.send_message(message.chat.id, "âŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯!")
        return
    
    old_amount = users[target_id].get('coins', 0)
    user_data = get_user(target_id)
    
    if negative_mode:
        # Ø­Ø§Ù„Øª Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†: Ù…ÙˆØ¬ÙˆØ¯ÛŒ = Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ - Ù…Ù‚Ø¯Ø§Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
        users[target_id]['coins'] = old_amount - amount
        action_text = "Ù…Ù†ÙÛŒ Ø´Ø¯"
        emoji = "âš ï¸"
        description = f"Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ù†ÙÛŒ Ø´Ø¯: {old_amount:,} - {amount:,} = {users[target_id]['coins']:,}"
    else:
        # Ø­Ø§Ù„Øª Ú©Ø§Ù‡Ø´ Ø¹Ø§Ø¯ÛŒ
        if old_amount < amount:
            bot.send_message(message.chat.id, f"âŒ Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±Ø¯!\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {old_amount:,} Ø³Ú©Ù‡")
            return
        
        users[target_id]['coins'] -= amount
        action_text = "Ú©Ø³Ø± Ø´Ø¯"
        emoji = "âœ…"
        description = f"Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡: {amount:,} Ø³Ú©Ù‡"
    
    save_data()
    
    # Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
    del waiting_for_admin_action[user_id]
    
    # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
    bot.send_message(
        message.chat.id,
        f"""
{emoji} **Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯** ({'Ù…Ù†ÙÛŒ Ú©Ø±Ø¯Ù†' if negative_mode else 'Ú©Ø§Ù‡Ø´ Ø¹Ø§Ø¯ÛŒ'})

ğŸ‘¤ **Ú©Ø§Ø±Ø¨Ø±:** {user_data['first_name']}
ğŸ†” **Ø¢ÛŒØ¯ÛŒ:** `{target_id}`
ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
{'â–' if negative_mode else 'â–'} **Ù…Ù‚Ø¯Ø§Ø±:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ“ **ØªÙˆØ¶ÛŒØ­:** {description}

ğŸ‘‘ **Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
""",
        parse_mode='Markdown'
    )
    
    # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
    try:
        if negative_mode:
            user_message = f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ù…Ù†ÙÛŒ Ø´Ø¯!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
"""
        else:
            user_message = f"""
âš ï¸ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª!**

ğŸ’° **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù‚Ø¨Ù„ÛŒ:** {old_amount:,} Ø³Ú©Ù‡
â– **Ù…Ù‚Ø¯Ø§Ø± Ú©Ø³Ø± Ø´Ø¯Ù‡:** {amount:,} Ø³Ú©Ù‡
ğŸ¯ **Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯:** {users[target_id]['coins']:,} Ø³Ú©Ù‡

ğŸ‘¤ **ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:** {message.from_user.first_name}
"""
        
        bot.send_message(
            int(target_id),
            user_message,
            reply_markup=get_admin_keyboard() if is_admin(int(target_id)) else get_main_keyboard()
        )
    except:
        pass




@bot.callback_query_handler(func=lambda call: call.data.startswith(('admin_addcoins_', 'admin_removecoins_', 'copyid_', 'moreinfo_', 'close_info', 'makeadmin_', 'removeadmin_')))
def handle_info_buttons(call):
    data = call.data
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
    if data.startswith('admin_') or data.startswith('makeadmin_') or data.startswith('removeadmin_'):
        if not is_admin(call.from_user.id):
            bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
            return
    
    if data == 'close_info':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('copyid_'):
        target_id = data.replace('copyid_', '')
        bot.send_message(call.message.chat.id, f"`{target_id}`", parse_mode='Markdown')
        bot.answer_callback_query(call.id, "âœ… Ø¢ÛŒØ¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯")
    
    elif data.startswith('moreinfo_'):
        target_id = data.replace('moreinfo_', '')
        user_data = get_user(target_id)
        
        info_text = f"""
ğŸ“Š **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø± {target_id}**

ğŸ² **Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²ÛŒ:**
â”œâ”€ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¨Ø±Ø¯/Ø¨Ø§Ø®Øª: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ù…Ø¬Ù…ÙˆØ¹ Ø´Ø±Ø·â€ŒÙ‡Ø§: {'Ù†Ø§Ù…Ø´Ø®Øµ'}

ğŸ’° **ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§:**
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† Ø´Ø§Ø±Ú˜: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªÙ‚Ø§Ù„: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡: {'Ù†Ø§Ù…Ø´Ø®Øµ'}

ğŸ“… **ØªØ§Ø±ÛŒØ®Ú†Ù‡:**
â”œâ”€ Ø§ÙˆÙ„ÛŒÙ† Ù¾ÛŒØ§Ù…: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª: {'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† âœ…'}
â”œâ”€ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†: {'Ø¢Ù†Ù„Ø§ÛŒÙ† ğŸŸ¢'}
"""
        bot.send_message(call.message.chat.id, info_text, parse_mode='Markdown')
        bot.answer_callback_query(call.id, "ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
    
    elif data.startswith('admin_addcoins_'):
        target_id = data.replace('admin_addcoins_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'add',
            'target_user_id': target_id
        }
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("100 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_100"),
            types.InlineKeyboardButton("500 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_500"),
            types.InlineKeyboardButton("1000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_1000")
        )
        markup.row(
            types.InlineKeyboardButton("5000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_5000"),
            types.InlineKeyboardButton("10000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_10000"),
            types.InlineKeyboardButton("Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"customadd_{target_id}")
        )
        
        bot.send_message(
            call.message.chat.id,
            f"â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown',
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('admin_removecoins_'):
        target_id = data.replace('admin_removecoins_', '')
        
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'remove',
            'target_user_id': target_id
        }
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("100 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_100"),
            types.InlineKeyboardButton("500 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_500"),
            types.InlineKeyboardButton("1000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_1000")
        )
        markup.row(
            types.InlineKeyboardButton("5000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_5000"),
            types.InlineKeyboardButton("10000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_10000"),
            types.InlineKeyboardButton("Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"customremove_{target_id}")
        )
        
        bot.send_message(
            call.message.chat.id,
            f"â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown',
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('makeadmin_'):
        if call.from_user.id != CREATOR_ID:
            bot.answer_callback_query(call.id, "âŒ ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ø¯!")
            return
        
        target_id = data.replace('makeadmin_', '')
        
        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
        admin_list[target_id] = {
            'permissions': {
                'send_receipt': True,
                'add_coins': True,
                'remove_coins': True,
                'manage_gift_codes': True
            }
        }
        save_data()
        
        bot.answer_callback_query(call.id, f"âœ… Ú©Ø§Ø±Ø¨Ø± {target_id} Ø§Ø¯Ù…ÛŒÙ† Ø´Ø¯!")
        
        # Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_addcoins_{target_id}"),
            types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_removecoins_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copyid_{target_id}"),
            types.InlineKeyboardButton("ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±", callback_data=f"moreinfo_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("âŒ Ø­Ø°Ù Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"removeadmin_{target_id}")
        )
        markup.row(types.InlineKeyboardButton("âŒ Ø¨Ø³ØªÙ†", callback_data="close_info"))
        
        try:
            bot.edit_message_reply_markup(
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=markup
            )
        except:
            pass
    
    elif data.startswith('removeadmin_'):
        if call.from_user.id != CREATOR_ID:
            bot.answer_callback_query(call.id, "âŒ ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø­Ø°Ù Ú©Ù†Ø¯!")
            return
        
        target_id = data.replace('removeadmin_', '')
        
        # Ø­Ø°Ù Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
        if target_id in admin_list:
            del admin_list[target_id]
            save_data()
        
        bot.answer_callback_query(call.id, f"âœ… Ú©Ø§Ø±Ø¨Ø± {target_id} Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯!")
        
        # Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_addcoins_{target_id}"),
            types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_removecoins_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copyid_{target_id}"),
            types.InlineKeyboardButton("ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±", callback_data=f"moreinfo_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("âœ… Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"makeadmin_{target_id}")
        )
        markup.row(types.InlineKeyboardButton("âŒ Ø¨Ø³ØªÙ†", callback_data="close_info"))
        
        try:
            bot.edit_message_reply_markup(
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=markup
            )
        except:
            pass




@bot.callback_query_handler(func=lambda call: call.data.startswith(('quickadd_', 'quickremove_', 'customadd_', 'customremove_')))
def handle_quick_actions(call):
    data = call.data
    
    if not is_admin(call.from_user.id):
        bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
        return
    
    if data.startswith('quickadd_'):
        parts = data.replace('quickadd_', '').split('_')
        target_id = parts[0]
        amount = int(parts[1])
        
        # Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        users[target_id]['coins'] += amount
        save_data()
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!")
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"âœ… Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯\n\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {target_id}\nâ• Ù…Ù‚Ø¯Ø§Ø±: {amount:,} Ø³Ú©Ù‡\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯: {users[target_id]['coins']:,} Ø³Ú©Ù‡"
        )
    
    elif data.startswith('quickremove_'):
        parts = data.replace('quickremove_', '').split('_')
        target_id = parts[0]
        amount = int(parts[1])
        
        # Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
        users[target_id]['coins'] -= amount
        save_data()
        
        bot.answer_callback_query(call.id, f"âœ… {amount:,} Ø³Ú©Ù‡ Ú©Ø³Ø± Ø´Ø¯!")
        
        # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯
        bot.send_message(
            call.message.chat.id,
            f"âœ… Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯\n\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {target_id}\nâ– Ù…Ù‚Ø¯Ø§Ø±: {amount:,} Ø³Ú©Ù‡\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯: {users[target_id]['coins']:,} Ø³Ú©Ù‡"
        )
    
    elif data.startswith('customadd_'):
        target_id = data.replace('customadd_', '')
        
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'add',
            'target_user_id': target_id
        }
        
        bot.send_message(call.message.chat.id, f"ğŸ’° Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        bot.answer_callback_query(call.id)
    
    elif data.startswith('customremove_'):
        target_id = data.replace('customremove_', '')
        
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'remove',
            'target_user_id': target_id
        }
        
        bot.send_message(call.message.chat.id, f"ğŸ’° Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø±Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:")
        bot.answer_callback_query(call.id)




@bot.message_handler(commands=['info', 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª'])
def user_info_admin(message):
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†
    if not is_admin(message.from_user.id):
        bot.reply_to(message, "âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª!")
        return
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø±ÛŒÙ¾Ù„Ø§ÛŒ
    if not message.reply_to_message:
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯.")
        return
    
    target_user = message.reply_to_message.from_user
    target_id = str(target_user.id)
    
    # Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    user_data = get_user(target_id)
    
    # Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡
    target_name = target_user.first_name or "Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…"
    target_username = f"@{target_user.username}" if target_user.username else "Ø¨Ø¯ÙˆÙ† ÛŒÙˆØ²Ø±Ù†ÛŒÙ…"
    
    # Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    coins = user_data.get('coins', 0)
    referral_count = user_data.get('referral_count', 0)
    total_earned = user_data.get('total_earned', 0)
    
    text = f"""
ğŸ” **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± - Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†**

ğŸ‘¤ **Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ:**
â”œâ”€ ğŸ†” Ø¢ÛŒØ¯ÛŒ: `{target_id}`
â”œâ”€ ğŸ‘¤ Ù†Ø§Ù…: {target_name}
â”œâ”€ ğŸ“› ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: {target_username}
â”œâ”€ ğŸ¤– Ø±Ø¨Ø§Øª: {'Ø¨Ù„Ù‡ ğŸ¤–' if target_user.is_bot else 'Ø®ÛŒØ± ğŸ‘¤'}
â”œâ”€ ğŸ‘‘ ÙˆØ¶Ø¹ÛŒØª: {'Ø§Ø¯Ù…ÛŒÙ† âœ…' if is_admin(int(target_id)) else 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ ğŸ‘¤'}

ğŸ’° **ÙˆØ¶Ø¹ÛŒØª Ù…Ø§Ù„ÛŒ:**
â”œâ”€ ğŸª™ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {coins:,} Ø³Ú©Ù‡
â”œâ”€ ğŸ’µ Ø§Ø±Ø²Ø´ ØªÙˆÙ…Ø§Ù†: {int((coins / 1000) * 40000):,} ØªÙˆÙ…Ø§Ù†
â”œâ”€ ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØª: {referral_count} Ù†ÙØ±
â”œâ”€ ğŸ¯ Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø¯Ø¹ÙˆØª: {total_earned:,} Ø³Ú©Ù‡

ğŸ“… **ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª:** {message.reply_to_message.date}
ğŸ‘¤ **Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡:** {message.from_user.first_name}
"""
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
    markup = types.InlineKeyboardMarkup()
    
    # Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
    markup.row(
        types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_addcoins_{target_id}"),
        types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_removecoins_{target_id}")
    )
    
    markup.row(
        types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copyid_{target_id}"),
        types.InlineKeyboardButton("ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±", callback_data=f"moreinfo_{target_id}")
    )
    
    # ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡/Ø­Ø°Ù Ú©Ù†Ø¯
    if message.from_user.id == CREATOR_ID:
        if is_admin(int(target_id)):
            markup.row(
                types.InlineKeyboardButton("âŒ Ø­Ø°Ù Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"removeadmin_{target_id}")
            )
        else:
            markup.row(
                types.InlineKeyboardButton("âœ… Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"makeadmin_{target_id}")
            )
    
    # Ø¯Ú©Ù…Ù‡ Ø¨Ø³ØªÙ†
    markup.row(types.InlineKeyboardButton("âŒ Ø¨Ø³ØªÙ†", callback_data="close_info"))
    
    # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
    try:
        bot.reply_to(message, text, parse_mode='Markdown', reply_markup=markup)
    except:
        # Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ Ø¨ÙˆØ¯
        clean_text = text.replace('*', '').replace('`', '').replace('_', '')
        bot.reply_to(message, clean_text, reply_markup=markup)




@bot.callback_query_handler(func=lambda call: call.data.startswith(('admin_addcoins_', 'admin_removecoins_', 'copyid_', 'moreinfo_', 'close_info', 'makeadmin_', 'removeadmin_')))
def handle_info_buttons(call):
    data = call.data
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
    if data.startswith('admin_') or data.startswith('makeadmin_') or data.startswith('removeadmin_'):
        if not is_admin(call.from_user.id):
            bot.answer_callback_query(call.id, "âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!")
            return
    
    if data == 'close_info':
        try:
            bot.delete_message(call.message.chat.id, call.message.message_id)
        except:
            bot.answer_callback_query(call.id, "âŒ Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ù†Ø´Ø¯")
        return
    
    elif data.startswith('copyid_'):
        target_id = data.replace('copyid_', '')
        bot.send_message(call.message.chat.id, f"`{target_id}`", parse_mode='Markdown')
        bot.answer_callback_query(call.id, "âœ… Ø¢ÛŒØ¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯")
    
    elif data.startswith('moreinfo_'):
        target_id = data.replace('moreinfo_', '')
        user_data = get_user(target_id)
        
        info_text = f"""
ğŸ“Š **Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø± {target_id}**

ğŸ² **Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²ÛŒ:**
â”œâ”€ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¨Ø±Ø¯/Ø¨Ø§Ø®Øª: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ù…Ø¬Ù…ÙˆØ¹ Ø´Ø±Ø·â€ŒÙ‡Ø§: {'Ù†Ø§Ù…Ø´Ø®Øµ'}

ğŸ’° **ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§:**
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† Ø´Ø§Ø±Ú˜: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† Ø§Ù†ØªÙ‚Ø§Ù„: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡: {'Ù†Ø§Ù…Ø´Ø®Øµ'}

ğŸ“… **ØªØ§Ø±ÛŒØ®Ú†Ù‡:**
â”œâ”€ Ø§ÙˆÙ„ÛŒÙ† Ù¾ÛŒØ§Ù…: {'Ù†Ø§Ù…Ø´Ø®Øµ'}
â”œâ”€ Ø¢Ø®Ø±ÛŒÙ† ÙØ¹Ø§Ù„ÛŒØª: {'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† âœ…'}
â”œâ”€ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†: {'Ø¢Ù†Ù„Ø§ÛŒÙ† ğŸŸ¢'}
"""
        bot.send_message(call.message.chat.id, info_text, parse_mode='Markdown')
        bot.answer_callback_query(call.id, "ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
    
    elif data.startswith('admin_addcoins_'):
        target_id = data.replace('admin_addcoins_', '')
        
        # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…ÙˆÙ‚Øª
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'add',
            'target_user_id': target_id
        }
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("100 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_100"),
            types.InlineKeyboardButton("500 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_500"),
            types.InlineKeyboardButton("1000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_1000")
        )
        markup.row(
            types.InlineKeyboardButton("5000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_5000"),
            types.InlineKeyboardButton("10000 Ø³Ú©Ù‡", callback_data=f"quickadd_{target_id}_10000"),
            types.InlineKeyboardButton("Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"customadd_{target_id}")
        )
        
        bot.send_message(
            call.message.chat.id,
            f"â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown',
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('admin_removecoins_'):
        target_id = data.replace('admin_removecoins_', '')
        
        waiting_for_admin_action[str(call.from_user.id)] = {
            'step': 'waiting_custom_amount',
            'type': 'remove',
            'target_user_id': target_id
        }
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("100 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_100"),
            types.InlineKeyboardButton("500 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_500"),
            types.InlineKeyboardButton("1000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_1000")
        )
        markup.row(
            types.InlineKeyboardButton("5000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_5000"),
            types.InlineKeyboardButton("10000 Ø³Ú©Ù‡", callback_data=f"quickremove_{target_id}_10000"),
            types.InlineKeyboardButton("Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡", callback_data=f"customremove_{target_id}")
        )
        
        bot.send_message(
            call.message.chat.id,
            f"â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± `{target_id}`\n\nÙ…Ù‚Ø¯Ø§Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            parse_mode='Markdown',
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
    
    elif data.startswith('makeadmin_'):
        if call.from_user.id != CREATOR_ID:
            bot.answer_callback_query(call.id, "âŒ ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ø¯!")
            return
        
        target_id = data.replace('makeadmin_', '')
        
        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
        admin_list[target_id] = {
            'permissions': {
                'send_receipt': True,
                'add_coins': True,
                'remove_coins': True,
                'manage_gift_codes': True
            }
        }
        save_data()
        
        bot.answer_callback_query(call.id, f"âœ… Ú©Ø§Ø±Ø¨Ø± {target_id} Ø§Ø¯Ù…ÛŒÙ† Ø´Ø¯!")
        
        # Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_addcoins_{target_id}"),
            types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_removecoins_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copyid_{target_id}"),
            types.InlineKeyboardButton("ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±", callback_data=f"moreinfo_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("âŒ Ø­Ø°Ù Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"removeadmin_{target_id}")
        )
        markup.row(types.InlineKeyboardButton("âŒ Ø¨Ø³ØªÙ†", callback_data="close_info"))
        
        try:
            bot.edit_message_reply_markup(
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=markup
            )
        except:
            pass
    
    elif data.startswith('removeadmin_'):
        if call.from_user.id != CREATOR_ID:
            bot.answer_callback_query(call.id, "âŒ ÙÙ‚Ø· Ù…Ø§Ù„Ú© Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø­Ø°Ù Ú©Ù†Ø¯!")
            return
        
        target_id = data.replace('removeadmin_', '')
        
        # Ø­Ø°Ù Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
        if target_id in admin_list:
            del admin_list[target_id]
            save_data()
        
        bot.answer_callback_query(call.id, f"âœ… Ú©Ø§Ø±Ø¨Ø± {target_id} Ø§Ø² Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯!")
        
        # Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton("â• Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_addcoins_{target_id}"),
            types.InlineKeyboardButton("â– Ú©Ø§Ù‡Ø´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ", callback_data=f"admin_removecoins_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒØ¯ÛŒ", callback_data=f"copyid_{target_id}"),
            types.InlineKeyboardButton("ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±", callback_data=f"moreinfo_{target_id}")
        )
        markup.row(
            types.InlineKeyboardButton("âœ… Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§", callback_data=f"makeadmin_{target_id}")
        )
        markup.row(types.InlineKeyboardButton("âŒ Ø¨Ø³ØªÙ†", callback_data="close_info"))
        
        try:
            bot.edit_message_reply_markup(
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=markup
            )
        except:
            pass





@bot.message_handler(commands=['start'])
def start(message):
    user_id = str(message.from_user.id)
    username = message.from_user.username or ''
    first_name = message.from_user.first_name or 'Ú©Ø§Ø±Ø¨Ø±'
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ù‡Ù…Ø±Ø§Ù‡ Ø§Ø³Øª
    referral_code = None
    if len(message.text.split()) > 1:
        referral_code = message.text.split()[1]
    
    # Ø§ÛŒØ¬Ø§Ø¯ ÛŒØ§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±
    get_user(user_id)
    users[user_id]['username'] = username
    users[user_id]['first_name'] = first_name
    
    # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø¹ÙˆØª
    if referral_code and referral_code.startswith('REF'):
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡
        inviter_id = None
        for uid, udata in users.items():
            if udata.get('referral_code') == referral_code and uid != user_id:
                inviter_id = uid
                break
        
        if inviter_id and users[user_id]['referred_by'] is None:
            # Ø«Ø¨Øª Ø¯Ø¹ÙˆØª
            users[user_id]['referred_by'] = inviter_id
            users[inviter_id]['referral_count'] += 1
            
            # Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ù‡ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ (ÛµÛ°Û° Ø³Ú©Ù‡)
            users[inviter_id]['coins'] += 500
            users[inviter_id]['total_earned'] += 500
            
            # Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ (Û²Û°Û° Ø³Ú©Ù‡)
            users[user_id]['coins'] += 200
            
            # Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
            save_data()
            
            # Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡
            try:
                bot.send_message(
                    int(inviter_id),
                    f"ğŸ‰ ÛŒÚ© Ø¯Ø¹ÙˆØª Ø¬Ø¯ÛŒØ¯!\n\nğŸ‘¤ {first_name} Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø´Ù…Ø§ Ø¹Ø¶Ùˆ Ø´Ø¯!\nğŸ’° ÛµÛ°Û° Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯!\nğŸ¯ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§: {users[inviter_id]['referral_count']}"
                )
            except:
                pass
    
    save_data()
    
    if message.chat.type != 'private':
        bot.send_message(
            message.chat.id,
            f'''ğŸ® Ø±Ø¨Ø§Øª Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!

ğŸ“‹ Ø¯Ø³ØªÙˆØ±Ø§Øª:
â€¢ Ø´Ø±Ø·Ø¨Ù†Ø¯ÛŒ [Ù…Ù‚Ø¯Ø§Ø±] - Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒ Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ
â€¢ Ù…ÙˆØ¬ÙˆØ¯ÛŒ - Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§
â€¢ .Ø§Ù†ØªÙ‚Ø§Ù„ - Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ú©Ù‡

ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ØŒ Ø¨Ù‡ Ù¾ÛŒÙˆÛŒ Ø±Ø¨Ø§Øª Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯: @{bot.get_me().username}'''
        )
        return
    
    # Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ Ø§Ø³ØªØ§Ø±Øª
    keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
    
    # Ú†Ú© Ú©Ø±Ø¯Ù† Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯Ø¹ÙˆØª Ø¢Ù…Ø¯Ù‡
    welcome_bonus = ""
    if referral_code and referral_code.startswith('REF'):
        welcome_bonus = "\n\nğŸ **Û²Û°Û° Ø³Ú©Ù‡ Ù‡Ø¯ÛŒÙ‡ Ø¹Ø¶ÙˆÛŒØª** Ø¨Ù‡ Ø´Ù…Ø§ ØªØ¹Ù„Ù‚ Ú¯Ø±ÙØª!\nØ¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø§ÛŒØ²Ù‡ØŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯."
    
    bot.send_message(
        message.chat.id,
        f'''Ø³Ù„Ø§Ù… {first_name} Ø¹Ø²ÛŒØ²! ğŸ‘‹

Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Gambler Spirit Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸ®

ğŸ† **Ø¬ÙˆØ§ÛŒØ² Ù‡ÙØªÚ¯ÛŒ:**
Ù‡Ø± Ù‡ÙØªÙ‡ Ø¨Ù‡ Û²Û° Ù†ÙØ± Ø¨Ø±ØªØ± Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù…ÙˆØ¬ÙˆØ¯ÛŒØŒ Ø¬ÙˆØ§ÛŒØ² Ù†Ù‚Ø¯ÛŒ Ø§Ø² Û± ØªØ§ Û²Û° Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù† Ø§Ù‡Ø¯Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯!

{welcome_bonus}

ğŸ“¤ **Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†:**
Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø§Ø®ØªØµØ§ØµÛŒ Ø®ÙˆØ¯ Ø¯ÙˆØ³ØªØ§Ù† Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø¹ÙˆØª Ù…ÙˆÙÙ‚ ÛµÛ°Û° Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯!

ğŸ“Œ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ú¯Ø²ÛŒÙ†Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:''',
        reply_markup=keyboard,
        parse_mode='Markdown'
    )
    
    # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø§Ø³Øª Ùˆ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯Ø¹ÙˆØª Ù†ÛŒØ§Ù…Ø¯Ù‡ØŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ø¹ÙˆØª
    if not referral_code and user_id in users and users[user_id].get('referred_by') is None:
        bot.send_message(
            message.chat.id,
            "ğŸ’¡ **Ù†Ú©ØªÙ‡:** Ø§Ú¯Ø± Ú©Ø³ÛŒ Ø´Ù…Ø§ Ø±Ø§ Ø¯Ø¹ÙˆØª Ù†Ú©Ø±Ø¯Ù‡ØŒ Ø§Ø² Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø§ØµØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ,ØªØ§ Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯!",
            parse_mode='Markdown'
        )

                  
                                        
    
@bot.message_handler(func=lambda m: m.text == 'ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§')
def guide(message):
    if message.chat.type != 'private':
        return
    
    text = '''ğŸ² Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ Gambler Spirit Bot! ğŸ²

Ø§ÛŒÙ† Ø±Ø¨Ø§Øª ÛŒÚ© Ø±Ø¨Ø§Øª Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø°Ø§Ø¨ Ùˆ Ø³Ø±Ú¯Ø±Ù…â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ù…Ú©Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø´Ø§Ù†Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø±Ù†Ø¯Ù‡ Ø³Ú©Ù‡ Ø´ÙˆÛŒØ¯!

Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø§ØµÙ„ÛŒ Ø±Ø¨Ø§Øª:

ğŸ’¸ Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ:

Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø±ÙˆÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ø´Ø±Ø· Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ùˆ Ø´Ø§Ù†Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.


ğŸ† Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø³Ú©Ù‡:

Ø³Ú©Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø®Ø±ÛŒØ¯ ÛŒØ§ Ø§Ù†Ø¬Ø§Ù… Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ø³Øª Ø¨ÛŒØ§ÙˆØ±ÛŒØ¯.


ğŸ’° Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ú©Ù‡:

Ø§Ù…Ú©Ø§Ù† Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§ Ø¨ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„ Ø§Ø³ØªØŒ Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† ØªØ¹Ø§Ù…Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.


ğŸ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡:

Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ØŒ Ø³Ú©Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†Ù†Ø¯.


ğŸ›  Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ:

Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„ ÛŒØ§ Ø¯Ø§Ø´ØªÙ† Ø³ÙˆØ§Ù„ØŒ Ù…ÛŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¢ÛŒØ¯ÛŒ Ø²ÛŒØ± Ø¨Ù‡ Ù…Ø§Ù„Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.

@Kia_CODM

Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø¯ÛŒÚ¯Ø± Ú©Ø§Ù…Ù†Ø¯ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:
    
    Ø¯Ø³ØªÙˆØ±Ø§Øª: 
    Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ: /Support
    Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø¨Ø§ Ø¬Ø§ÛŒØ²Ù‡ Ø¨Ø²Ø±Ú¯: /invite

â•­â”â”â‹†â”â€ğŸŒŸâ€â”â‹†â”â”â•®
 @GamblerSpirit_Bot
â•°â”â”â‹†â”â€ğŸŒŸâ€â”â‹†â”â”â•¯
    '''
    bot.send_message(message.chat.id, text, reply_markup=get_main_keyboard() if not is_admin(message.from_user.id) else get_admin_keyboard())





@bot.message_handler(func=lambda m: m.text == 'â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡')
def add_to_group(message):
    if message.chat.type != 'private':
        return
    
    markup = types.InlineKeyboardMarkup()
    bot_username = bot.get_me().username
    add_url = f'https://t.me/{bot_username}?startgroup=true'
    markup.row(types.InlineKeyboardButton('â• Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡', url=add_url))
    
    text = '''ğŸ® Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†!

Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ ØªÙˆÛŒ Ú¯Ø±ÙˆÙ‡ Ø®ÙˆØ¯Øª Ùˆ Ø±ÙÛŒÙ‚Ø§Øª Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØŒ Ù‡Ù…ÛŒÙ† Ø­Ø§Ù„Ø§ Ø±Ø¨Ø§Øª Ø±Ùˆ Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†! ğŸ”¥

âœ¨ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ú¯Ø±ÙˆÙ‡:
â€¢ Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†
â€¢ Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ú©Ù‡ Ø¨Ù‡ ÛŒÚ©Ø¯ÛŒÚ¯Ø±
â€¢ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ

ğŸ‘‡ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø¨Ø²Ù† Ùˆ Ú¯Ø±ÙˆÙ‡Øª Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†'''
    
    bot.send_message(message.chat.id, text, reply_markup=markup)

@bot.message_handler(func=lambda m: m.text == 'ğŸ” Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†')
def admin_panel(message):
    if message.chat.type != 'private':
        return
    
    user_id = message.from_user.id
    
    if not is_admin(user_id):
        bot.send_message(message.chat.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
        return
    
    markup = types.InlineKeyboardMarkup()
    
    if has_permission(user_id, 'remove_coins'):
        markup.row(types.InlineKeyboardButton('â– Ú©Ø³Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ', callback_data='admin_remove'))
    
    if has_permission(user_id, 'add_coins'):
        markup.row(types.InlineKeyboardButton('â• Ø§Ø¶Ø§ÙÙ‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ', callback_data='admin_add'))
    
    if has_permission(user_id, 'manage_gift_codes'):
        markup.row(types.InlineKeyboardButton('ğŸ ØªÙ†Ø¸ÛŒÙ… Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡', callback_data='admin_giftcode'))
    
    if user_id == CREATOR_ID:
        markup.row(types.InlineKeyboardButton('ğŸ‘¥ Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¯Ù…ÛŒÙ†', callback_data='admin_addadmin'))
        markup.row(types.InlineKeyboardButton('âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§', callback_data='admin_manage'))
    
    text = '''ğŸ” Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
    
    Ø±Ø§Ø¨Ø±Øª
Ù„Ø·ÙØ§ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø§ØµØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.'''
    
    bot.send_message(message.chat.id, text, reply_markup=markup)

@bot.message_handler(func=lambda m: m.text == 'ğŸ Ø«Ø¨Øª Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡')
def enter_gift_code(message):
    if message.chat.type != 'private':
        return
    
    user_id = str(message.from_user.id)
    
    waiting_for_gift_code[user_id] = {'step': 'waiting_code'}
    
    bot.send_message(
        message.chat.id,
        'ğŸ Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:',
        reply_markup=types.ReplyKeyboardRemove()
    )

@bot.message_handler(func=lambda m: m.text == 'ğŸ’³ Ø´Ø§Ø±Ú˜ Ù…ÙˆØ¬ÙˆØ¯ÛŒ')
def charge_balance(message):
    if message.chat.type != 'private':
        return
    
    user_id = str(message.from_user.id)
    
    msg = bot.send_message(
        message.chat.id,
        'ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø³ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\nâ€”',
        reply_markup=get_coin_keyboard()
    )
    
    waiting_for_receipt[user_id] = {'step': 'amount', 'amount': ''}
    user_messages[user_id] = msg.message_id

@bot.message_handler(func=lambda m: m.text == 'ğŸ¦ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ')
def account_info(message):
    if message.chat.type != 'private':
        return
    
    user_id = str(message.from_user.id)
    user = get_user(user_id)
    
    text = f'''ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ

ğŸ†” Ø¢ÛŒØ¯ÛŒ: {user_id}
ğŸ‘¤ Ù†Ø§Ù…: {user['first_name']}
ğŸ“± ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @{user['username']}
ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ: {user['coins']:,} Ø³Ú©Ù‡'''
    
    keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
    bot.send_message(message.chat.id, text, reply_markup=keyboard)

@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_gift_code)
def handle_gift_code_input(message):
    user_id = str(message.from_user.id)
    
    if user_id not in waiting_for_gift_code:
        return
    
    code = message.text.strip()
    
    if code not in gift_codes:
        keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
        bot.send_message(message.chat.id, 'âŒ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª!', reply_markup=keyboard)
        del waiting_for_gift_code[user_id]
        return
    
    gift_data = gift_codes[code]
    
    if user_id in gift_data.get('used_by', []):
        keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
        bot.send_message(message.chat.id, 'âŒ Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø² Ø§ÛŒÙ† Ú©Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!', reply_markup=keyboard)
        del waiting_for_gift_code[user_id]
        return
    
    if len(gift_data.get('used_by', [])) >= gift_data['max_uses']:
        keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
        bot.send_message(message.chat.id, 'âŒ Ø¸Ø±ÙÛŒØª Ø§ÛŒÙ† Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ø§Ø³Øª!', reply_markup=keyboard)
        del waiting_for_gift_code[user_id]
        return
    
    users[user_id]['coins'] += gift_data['coins']
    
    if 'used_by' not in gift_codes[code]:
        gift_codes[code]['used_by'] = []
    gift_codes[code]['used_by'].append(user_id)
    
    save_data()
    
    keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
    bot.send_message(
        message.chat.id,
        f'''ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯

ğŸª™ {gift_data['coins']:,} Ø³Ú©Ù‡ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯: {users[user_id]['coins']:,} Ø³Ú©Ù‡''',
        reply_markup=keyboard
    )
    
    del waiting_for_gift_code[user_id]

@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_receipt and waiting_for_receipt[str(m.from_user.id)]['step'] == 'amount')
def handle_charge_amount(message):
    user_id = str(message.from_user.id)
    text = message.text
    
    if text == 'âŒ Ù„ØºÙˆ':
        del waiting_for_receipt[user_id]
        if user_id in user_messages:
            del user_messages[user_id]
        keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
        bot.send_message(message.chat.id, 'âŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯', reply_markup=keyboard)
        return
    
    if text == 'âŒ«':
        waiting_for_receipt[user_id]['amount'] = waiting_for_receipt[user_id]['amount'][:-1]
        amount = waiting_for_receipt[user_id]['amount'] or ''
        display_text = amount if amount else 'â€”'
        
        if user_id in user_messages:
            try:
                bot.edit_message_text(
                    f'ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø³ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n{display_text}',
                    chat_id=message.chat.id,
                    message_id=user_messages[user_id]
                )
            except:
                pass
        return
    
    if text == 'ØªØ§ÛŒÛŒØ¯ âœ…':
        amount = waiting_for_receipt[user_id]['amount']
        if not amount.isdigit():
            bot.send_message(message.chat.id, 'âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!')
            return
        
        if len(amount) > 10:
            bot.send_message(message.chat.id, 'âŒ Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯ Ø§Ø³Øª! Ø­Ø¯Ø§Ú©Ø«Ø± 10 Ø±Ù‚Ù… Ù…Ø¬Ø§Ø² Ø§Ø³Øª.')
            return
        
        if int(amount) < 10:
            bot.send_message(message.chat.id, 'âŒ Ø­Ø¯Ø§Ù‚Ù„ Ù…Ù‚Ø¯Ø§Ø± 10 Ø³Ú©Ù‡ Ø§Ø³Øª!')
            return
        
        if int(amount) > 9999999999:
            bot.send_message(message.chat.id, 'âŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ù‚Ø¯Ø§Ø± 9,999,999,999 Ø³Ú©Ù‡ Ø§Ø³Øª!')
            return
        
        coins = int(amount)
        price = int((coins / 1000) * 40000)
        
        waiting_for_receipt[user_id] = {'step': 'receipt', 'coins': coins, 'price': price}
        
        if user_id in user_messages:
            del user_messages[user_id]
        
        try:
            with open('1.jpg', 'rb') as photo:
                bot.send_photo(
                    message.chat.id,
                    photo,
                    caption=f'''Ù…Ø´ØªØ±Ú© Ú¯Ø±Ø§Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø²ÛŒØ± ÙˆØ§Ø±ÛŒØ² Ú©Ù†ÛŒØ¯ğŸ™

ğŸ’³ {CARD_NUMBER}
ğŸ‘¤ Ø¨Ù‡ Ù†Ø§Ù…: Ø§ÙØªØ®Ø§Ø±ÛŒ

ğŸ’° Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ±: {price:,} ØªÙˆÙ…Ø§Ù†
ğŸª™ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡: {coins:,}

ğŸ“Œ Ù†Ú©ØªÙ‡: Ù‡Ø± 1,000 Ø³Ú©Ù‡ = 40,000 ØªÙˆÙ…Ø§Ù†âš ï¸ Ù„Ø·ÙØ§ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯ ÙÛŒÚ© Ø¬Ø¯Ø§Ù‹ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯ğŸ›¡

ğŸ“¸ Ù„Ø·ÙØ§ Ø¹Ú©Ø³ Ø±Ø³ÛŒØ¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨ÙØ±Ø³ØªÛŒØ¯''',
                    reply_markup=types.ReplyKeyboardRemove()
                )
        except:
            bot.send_message(
                message.chat.id,
                f'''Ù…Ø´ØªØ±Ú© Ú¯Ø±Ø§Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ± Ø±Ø§ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø²ÛŒØ± ÙˆØ§Ø±ÛŒØ² Ú©Ù†ÛŒØ¯ğŸ™

ğŸ’³ {CARD_NUMBER}
ğŸ‘¤ Ø¨Ù‡ Ù†Ø§Ù…: Ø§ÙØªØ®Ø§Ø±ÛŒ

ğŸ’° Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ±: {price:,} ØªÙˆÙ…Ø§Ù†
ğŸª™ ØªØ¹Ø¯Ø§Ø¯ Ø³Ú©Ù‡: {coins:,}

ğŸ“Œ Ù†Ú©ØªÙ‡: Ù‡Ø± 1,000 Ø³Ú©Ù‡ = 40,000 ØªÙˆÙ…Ø§Ù†
âš ï¸ Ù„Ø·ÙØ§ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯ ÙÛŒÚ© Ø¬Ø¯Ø§Ù‹ Ø®ÙˆØ¯Ø¯Ø§Ø±ÛŒ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯ğŸ›¡

ğŸ“¸ Ù„Ø·ÙØ§ Ø¹Ú©Ø³ Ø±Ø³ÛŒØ¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨ÙØ±Ø³ØªÛŒØ¯''',
                reply_markup=types.ReplyKeyboardRemove()
            )
        return
    
    if text.isdigit():
        if len(waiting_for_receipt[user_id]['amount'] + text) > 10:
            bot.send_message(message.chat.id, 'âŒ Ø­Ø¯Ø§Ú©Ø«Ø± 10 Ø±Ù‚Ù… Ù…Ø¬Ø§Ø² Ø§Ø³Øª!')
            return
        
        waiting_for_receipt[user_id]['amount'] += text
        amount = waiting_for_receipt[user_id]['amount']
        
        if user_id in user_messages:
            try:
                bot.edit_message_text(
                    f'ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø³ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n{amount}',
                    chat_id=message.chat.id,
                    message_id=user_messages[user_id]
                )
            except:
                pass

@bot.message_handler(content_types=['photo'])
def handle_photo(message):
    user_id = str(message.from_user.id)
    
    if user_id in waiting_for_receipt and waiting_for_receipt[user_id]['step'] == 'receipt':
        photo = message.photo[-1].file_id
        coins = waiting_for_receipt[user_id]['coins']
        price = waiting_for_receipt[user_id]['price']
        username = users[user_id]['username']
        first_name = users[user_id]['first_name']
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton('âœ… ØªØ§ÛŒÛŒØ¯', callback_data=f'approve_{user_id}_{coins}'),
            types.InlineKeyboardButton('âŒ Ø±Ø¯', callback_data=f'reject_{user_id}')
        )
        
        caption = f'''ğŸ“© Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø§Ø±Ú˜ Ø¬Ø¯ÛŒØ¯

ğŸ‘¤ Ù†Ø§Ù…: {first_name}
ğŸ†” ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @{username}
ğŸ”¢ Ø¢ÛŒØ¯ÛŒ: {user_id}
ğŸ’° Ù…Ø¨Ù„Øº: {price:,} ØªÙˆÙ…Ø§Ù†
ğŸª™ Ø³Ú©Ù‡: {coins:,}'''
        
        admin_messages[f'charge_{user_id}'] = []
        
        admins_to_send = set()
        admins_to_send.add(ADMIN_ID)
        
        for admin_id_str in admin_list:
            if has_permission(int(admin_id_str), 'send_receipt'):
                admins_to_send.add(int(admin_id_str))
        
        for admin_id_int in admins_to_send:
            try:
                msg = bot.send_photo(admin_id_int, photo, caption=caption, reply_markup=markup)
                admin_messages[f'charge_{user_id}'].append({
                    'chat_id': admin_id_int,
                    'message_id': msg.message_id
                })
            except Exception as e:
                print(f'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† {admin_id_int}: {e}')
        
        del waiting_for_receipt[user_id]
        
        keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
        bot.send_message(
            message.chat.id,
            'âœ… Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯\nâ³ Ù„Ø·ÙØ§Ù‹ Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù…Ø§Ù†ÛŒØ¯...',
            reply_markup=keyboard
        )

@bot.message_handler(func=lambda m: str(m.from_user.id) in waiting_for_admin_action)
def handle_admin_input(message):
    user_id = str(message.from_user.id)
    action_data = waiting_for_admin_action[user_id]
    
    if action_data['step'] == 'gift_code_name':
        code_name = message.text.strip()
        
        if code_name in gift_codes:
            bot.send_message(message.chat.id, 'âŒ Ø§ÛŒÙ† Ú©Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ø§Ú©Ø§Ù†Øª Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª')
            return
        
        waiting_for_admin_action[user_id] = {'step': 'gift_code_coins', 'code': code_name}
        bot.send_message(message.chat.id, f'ğŸª™ Ú†Ù†Ø¯ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ "{code_name}" Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ø´ÙˆØ¯ØŸ')
        return
    
    elif action_data['step'] == 'gift_code_coins':
        if not message.text.isdigit():
            bot.send_message(message.chat.id, 'âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:')
            return
        
        coins = int(message.text)
        waiting_for_admin_action[user_id]['coins'] = coins
        waiting_for_admin_action[user_id]['step'] = 'gift_code_uses'
        
        bot.send_message(message.chat.id, f'ğŸ‘¥ Ú†Ù†Ø¯ Ù†ÙØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§Ø² Ø§ÛŒÙ† Ú©Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ù†Ø¯ØŸ')
        return
    
    elif action_data['step'] == 'gift_code_uses':
        if not message.text.isdigit():
            bot.send_message(message.chat.id, 'âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:')
            return
        
        max_uses = int(message.text)
        code = action_data['code']
        coins = action_data['coins']
        
        gift_codes[code] = {
            'coins': coins,
            'max_uses': max_uses,
            'used_by': []
        }
        save_data()
        
        bot.send_message(
            message.chat.id,
            f'''âœ… Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!

ğŸ Ú©Ø¯: {code}
ğŸª™ Ù…Ù‚Ø¯Ø§Ø±: {coins:,} Ø³Ú©Ù‡
ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡: {max_uses} Ù†ÙØ±'''
        )
        
        del waiting_for_admin_action[user_id]
        return
    
    elif action_data['step'] == 'waiting_userid':
        identifier = message.text.strip().replace('@', '')
        
        target_user_id = None
        
        for uid, udata in users.items():
            if udata['username'] == identifier:
                target_user_id = uid
                break
        
        if not target_user_id and identifier.isdigit():
            if identifier in users:
                target_user_id = identifier
        
        if not target_user_id:
            bot.send_message(message.chat.id, 'âŒ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯! Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¢ÛŒØ¯ÛŒ ÛŒØ§ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:')
            return
        
        user = get_user(target_user_id)
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton('100', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_100'),
            types.InlineKeyboardButton('500', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_500'),
            types.InlineKeyboardButton('1000', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_1000')
        )
        markup.row(
            types.InlineKeyboardButton('5000', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_5000'),
            types.InlineKeyboardButton('10000', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_10000'),
            types.InlineKeyboardButton('50000', callback_data=f'setamount_{action_data["type"]}_{target_user_id}_50000')
        )
        markup.row(types.InlineKeyboardButton('ğŸ”¢ Ù…Ø¨Ù„Øº Ø¯Ù„Ø®ÙˆØ§Ù‡', callback_data=f'customamount_{action_data["type"]}_{target_user_id}'))
        
        action_text = 'Ú©Ø³Ø±' if action_data['type'] == 'remove' else 'Ø§Ø¶Ø§ÙÙ‡'
        
        text = f'''ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:

ğŸ†” Ø¢ÛŒØ¯ÛŒ: {target_user_id}
ğŸ‘¤ Ù†Ø§Ù…: {user['first_name']}
ğŸ“± ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @{user['username']}
ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ: {user['coins']:,} Ø³Ú©Ù‡

Ú†Ù‡ Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ {action_text} Ú©Ù†ÛŒØ¯ØŸ'''
        
        bot.send_message(message.chat.id, text, reply_markup=markup)
        del waiting_for_admin_action[user_id]
    
    elif action_data['step'] == 'waiting_custom_amount':
        if not message.text.isdigit():
            bot.send_message(message.chat.id, 'âŒ Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:')
            return
        
        amount = int(message.text)
        target_user_id = action_data['target_user_id']
        action_type = action_data['type']
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton('âœ… ØªØ§ÛŒÛŒØ¯', callback_data=f'confirm_{action_type}_{target_user_id}_{amount}'),
            types.InlineKeyboardButton('âŒ Ù„ØºÙˆ', callback_data='cancel_admin')
        )
        
        action_text = 'Ú©Ø³Ø±' if action_type == 'remove' else 'Ø§Ø¶Ø§ÙÙ‡'
        user = get_user(target_user_id)
        
        text = f'''âš ï¸ ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ

ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {user['first_name']} ({target_user_id})
ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {user['coins']:,} Ø³Ú©Ù‡
ğŸ”„ Ù…Ù‚Ø¯Ø§Ø± {action_text}: {amount:,} Ø³Ú©Ù‡

Ø¢ÛŒØ§ Ø§Ø² Ø§ÛŒÙ† ØªØµÙ…ÛŒÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ'''
        
        bot.send_message(message.chat.id, text, reply_markup=markup)
        del waiting_for_admin_action[user_id]
    
    elif action_data['step'] == 'waiting_new_admin':
        identifier = message.text.strip().replace('@', '')
        
        new_admin_id = None
        
        for uid, udata in users.items():
            if udata['username'] == identifier:
                new_admin_id = uid
                break
        
        if not new_admin_id and identifier.isdigit():
            new_admin_id = identifier
        
        if not new_admin_id:
            bot.send_message(message.chat.id, 'âŒ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:')
            return
        
        if new_admin_id in admin_list:
            bot.send_message(message.chat.id, 'âŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª')
            del waiting_for_admin_action[user_id]
            return
        
        admin_list[new_admin_id] = {
            'permissions': {
                'send_receipt': True,
                'add_coins': True,
                'remove_coins': True,
                'manage_gift_codes': True
            }
        }
        save_data()
        
        user = get_user(new_admin_id)
        bot.send_message(message.chat.id, f'âœ… Ú©Ø§Ø±Ø¨Ø± {user["first_name"]} ({new_admin_id}) Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯')
        
        try:
            bot.send_message(
                int(new_admin_id),
                'ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¯Ù…ÛŒÙ† Ø±Ø¨Ø§Øª Ù…Ù†ØµÙˆØ¨ Ø´Ø¯ÛŒØ¯.\n\nØ§Ø² Ø¯Ø³ØªÙˆØ± /start Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.',
                reply_markup=get_admin_keyboard()
            )
        except:
            pass
        
        del waiting_for_admin_action[user_id]

@bot.message_handler(func=lambda m: m.chat.type != 'private' and m.text and m.text.startswith('Ø§Ù†ØªÙ‚Ø§Ù„'))
def transfer_coins(message):
    user_id = str(message.from_user.id)
    user = get_user(user_id)
    sender_username = users[user_id]['username'] or message.from_user.first_name
    
    if message.reply_to_message:
        match = re.match(r'\Ø§Ù†ØªÙ‚Ø§Ù„\s+(\d+)', message.text)
        if not match:
            bot.reply_to(message, 'âŒ ÙØ±Ù…Øª ØµØ­ÛŒØ­: Ø§Ù†ØªÙ‚Ø§Ù„ [Ù…Ù‚Ø¯Ø§Ø±]')
            return
        
        amount = int(match.group(1))
        target_user_id = str(message.reply_to_message.from_user.id)
        target_user = get_user(target_user_id)
        target_username = target_user['username'] or message.reply_to_message.from_user.first_name
        
    else:
        match = re.match(r'\.Ø§Ù†ØªÙ‚Ø§Ù„\s+[@]?(\w+)\s+(\d+)', message.text)
        if not match:
            bot.reply_to(message, 'âŒ ÙØ±Ù…Øª ØµØ­ÛŒØ­: .Ø§Ù†ØªÙ‚Ø§Ù„ @username [Ù…Ù‚Ø¯Ø§Ø±] ÛŒØ§ Ø§Ù†ØªÙ‚Ø§Ù„ [Ø¢ÛŒØ¯ÛŒ] [Ù…Ù‚Ø¯Ø§Ø±]')
            return
        
        identifier = match.group(1)
        amount = int(match.group(2))
        
        target_user_id = None
        target_username = None
        
        for uid, udata in users.items():
            if udata['username'] == identifier:
                target_user_id = uid
                target_username = udata['username']
                break
        
        if not target_user_id and identifier.isdigit():
            if identifier in users:
                target_user_id = identifier
                target_user = get_user(target_user_id)
                target_username = target_user['username'] or target_user['first_name']
        
        if not target_user_id:
            bot.reply_to(message, 'âŒ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!')
            return
    
    if target_user_id == user_id:
        bot.reply_to(message, 'âŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ Ø®ÙˆØ¯ØªØ§Ù† Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ù‡ÛŒØ¯!')
        return
    
    if amount < 1:
        bot.reply_to(message, 'âŒ Ø­Ø¯Ø§Ù‚Ù„ Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„ 1 Ø³Ú©Ù‡ Ø§Ø³Øª!')
        return
    
    if user['coins'] < amount:
        bot.reply_to(message, f'âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§: {user["coins"]:,} Ø³Ú©Ù‡')
        return
    
    tax = int(amount * TRANSFER_TAX)
    final_amount = amount - tax
    
    users[user_id]['coins'] -= amount
    users[target_user_id]['coins'] += final_amount
    save_data()
    
    receipt = f'''Ø±Ø³ÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ú©Ù‡
    ğ†ğšğ¦ğ›ğ¥ğğ« ğ’ğ©ğ¢ğ«ğ¢ğ­
ğŸ‘¤ ÙØ±Ø³ØªÙ†Ø¯Ù‡: @{sender_username}
ğŸ‘¥ Ú¯ÛŒØ±Ù†Ø¯Ù‡: @{target_username}
ğŸ’µ Ù…Ø¨Ù„Øº: {amount}
ğŸ§¾ Ù…Ø§Ù„ÛŒØ§Øª: {tax} (5%)
âœ… ÙˆØ§Ø±ÛŒØ²ÛŒ Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡: {final_amount}'''
    
    bot.reply_to(message, receipt)

@bot.message_handler(func=lambda m: m.chat.type != 'private' and m.text and m.text.startswith('Ø´Ø±Ø·Ø¨Ù†Ø¯ÛŒ'))
def create_game(message):
    user_id = str(message.from_user.id)
    user = get_user(user_id)
    username = users[user_id]['username'] or message.from_user.first_name
    
    match = re.match(r'Ø´Ø±Ø·Ø¨Ù†Ø¯ÛŒ\s+(\d+)', message.text)
    if not match:
        bot.reply_to(message, 'âŒ ÙØ±Ù…Øª ØµØ­ÛŒØ­: Ø´Ø±Ø·Ø¨Ù†Ø¯ÛŒ [Ù…Ù‚Ø¯Ø§Ø±]')
        return
    
    amount = int(match.group(1))
    
    if amount < 20:
        bot.reply_to(message, 'âŒ Ø­Ø¯Ø§Ù‚Ù„ Ù…Ù‚Ø¯Ø§Ø± Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ 20 Ø³Ú©Ù‡ Ø§Ø³Øª!')
        return
    
    if user['coins'] < amount:
        bot.reply_to(message, f'âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§: {user["coins"]:,} Ø³Ú©Ù‡')
        return
    
    game_id = str(random.randint(10000, 99999))
    
    active_games[game_id] = {
        'creator': {'id': user_id, 'username': username},
        'amount': amount,
        'participants': []
    }
    save_data()
    
    markup = types.InlineKeyboardMarkup()
    markup.row(
        types.InlineKeyboardButton('ğŸ® Ø´Ø±Ú©Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ', callback_data=f'join_{game_id}_{user_id}')
    )
    markup.row(
        types.InlineKeyboardButton('âŒ Ø¨Ø³ØªÙ† Ø¨Ø§Ø²ÛŒ', callback_data=f'close_{game_id}_{user_id}')
    )
    
    game_text = f'''â—ˆ â”â”â” ğ†ğšğ¦ğ›ğ¥ğğ«ğ’ğ©ğ¢ğ«ğ¢ğ­ â”â”â” â—ˆ
ğ•ğˆğ | Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!
ğ•ğˆğ | Ø³Ø§Ø²Ù†Ø¯Ù‡ : {username} (<code>{user_id}</code>)
ğ•ğˆğ | Ù…Ø¨Ù„Øº Ø´Ø±Ø· : {amount:,} Ø³Ú©Ù‡
ğ•ğˆğ | Ø´Ø±Ú©Øª Ú©Ù†Ù†Ø¯Ù‡ : 0/1
â—ˆ â”â”â” ğ†ğšğ¦ğ›ğ¥ğğ«ğ’ğ©ğ¢ğ«ğ¢ğ­ â”â”â” â—ˆ'''
    
    try:
        with open('2.jpg', 'rb') as photo:
            bot.send_photo(
                message.chat.id,
                photo,
                caption=game_text,
                reply_markup=markup,
                parse_mode='HTML'
            )
    except:
        bot.send_message(
            message.chat.id,
            game_text,
            reply_markup=markup,
            parse_mode='HTML'
        )

@bot.message_handler(func=lambda m: m.chat.type != 'private' and m.text and m.text == 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ')
def check_balance_group(message):
    user_id = str(message.from_user.id)
    user = get_user(user_id)
    
    coins = user['coins']
    tomans = int((coins / 1000) * 40000)
    
    balance_text = f'''Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ :
Ø³Ú©Ù‡ ğŸª™: {coins:,}
Ø¨Ù‡ ØªÙˆÙ…Ø§Ù† : {tomans:,}'''
    
    bot.reply_to(message, balance_text)

@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call):
    data = call.data
    admin_id = call.from_user.id
    
    if data == 'admin_remove':
        if not has_permission(admin_id, 'remove_coins'):
            bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
            return
        
        waiting_for_admin_action[str(admin_id)] = {'step': 'waiting_userid', 'type': 'remove'}
        bot.send_message(admin_id, 'ğŸ”¢ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ ÛŒØ§ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÙ…Ø«Ø§Ù„: 123456789 ÛŒØ§ @username')
        bot.answer_callback_query(call.id)
        return
    
    elif data == 'admin_add':
        if not has_permission(admin_id, 'add_coins'):
            bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
            return
        
        waiting_for_admin_action[str(admin_id)] = {'step': 'waiting_userid', 'type': 'add'}
        bot.send_message(admin_id, 'ğŸ”¢ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ ÛŒØ§ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÙ…Ø«Ø§Ù„: 123456789 ÛŒØ§ @username')
        bot.answer_callback_query(call.id)
        return
    
    elif data == 'admin_giftcode':
        if not has_permission(admin_id, 'manage_gift_codes'):
            bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
            return
        
        waiting_for_admin_action[str(admin_id)] = {'step': 'gift_code_name'}
        bot.send_message(admin_id, 'ğŸ Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\nÙ…Ø«Ø§Ù„: Gembler spirit')
        bot.answer_callback_query(call.id)
        return
    
    elif data == 'admin_addadmin':
        if admin_id != CREATOR_ID:
            bot.answer_callback_query(call.id, 'âŒ ÙÙ‚Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ø¯!')
            return
        
        waiting_for_admin_action[str(admin_id)] = {'step': 'waiting_new_admin'}
        bot.send_message(admin_id, 'ğŸ”¢ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ ÛŒØ§ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÙ…Ø«Ø§Ù„: 123456789 ÛŒØ§ @username')
        bot.answer_callback_query(call.id)
        return
    
    elif data == 'admin_manage':
        if admin_id != CREATOR_ID:
            bot.answer_callback_query(call.id, 'âŒ ÙÙ‚Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯!')
            return
        
        markup = types.InlineKeyboardMarkup()
        for admin_id_str, admin_data in admin_list.items():
            if admin_id_str != str(CREATOR_ID):
                user = get_user(admin_id_str)
                markup.row(types.InlineKeyboardButton(
                    f"ğŸ‘¤ {user['first_name']} ({admin_id_str})",
                    callback_data=f'manageadmin_{admin_id_str}'
                ))
        
        markup.row(types.InlineKeyboardButton('ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª', callback_data='back_to_admin'))
        
        bot.edit_message_text(
            'ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§\n\nØ±ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:',
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('manageadmin_'):
        if admin_id != CREATOR_ID:
            bot.answer_callback_query(call.id, 'âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯!')
            return
        
        target_admin_id = data.split('_')[1]
        admin_data = admin_list.get(target_admin_id, {})
        permissions = admin_data.get('permissions', {})
        user = get_user(target_admin_id)
        
        markup = types.InlineKeyboardMarkup()
        
        send_receipt_status = 'âœ…' if permissions.get('send_receipt', False) else 'âŒ'
        markup.row(types.InlineKeyboardButton(
            f'{send_receipt_status} Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯',
            callback_data=f'toggleperm_{target_admin_id}_send_receipt'
        ))
        
        add_coins_status = 'âœ…' if permissions.get('add_coins', False) else 'âŒ'
        markup.row(types.InlineKeyboardButton(
            f'{add_coins_status} Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
            callback_data=f'toggleperm_{target_admin_id}_add_coins'
        ))
        
        remove_coins_status = 'âœ…' if permissions.get('remove_coins', False) else 'âŒ'
        markup.row(types.InlineKeyboardButton(
            f'{remove_coins_status} Ú©Ø³Ø± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
            callback_data=f'toggleperm_{target_admin_id}_remove_coins'
        ))
        
        gift_codes_status = 'âœ…' if permissions.get('manage_gift_codes', False) else 'âŒ'
        markup.row(types.InlineKeyboardButton(
            f'{gift_codes_status} Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡',
            callback_data=f'toggleperm_{target_admin_id}_manage_gift_codes'
        ))
        
        markup.row(
            types.InlineKeyboardButton('ğŸ—‘ Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†', callback_data=f'removeadmin_{target_admin_id}'),
        )
        markup.row(types.InlineKeyboardButton('ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª', callback_data='admin_manage'))
        
        bot.edit_message_text(
            f'âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†\n\nğŸ‘¤ Ù†Ø§Ù…: {user["first_name"]}\nğŸ†” Ø¢ÛŒØ¯ÛŒ: {target_admin_id}\n\nğŸ“‹ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§:',
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            reply_markup=markup
        )
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('toggleperm_'):
        if admin_id != CREATOR_ID:
            bot.answer_callback_query(call.id, 'âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯!')
            return
        
        parts = data.split('_')
        target_admin_id = parts[1]
        permission = '_'.join(parts[2:])
        
        if target_admin_id in admin_list:
            current_value = admin_list[target_admin_id]['permissions'].get(permission, False)
            admin_list[target_admin_id]['permissions'][permission] = not current_value
            save_data()
            
            admin_data = admin_list.get(target_admin_id, {})
            permissions = admin_data.get('permissions', {})
            user = get_user(target_admin_id)
            
            markup = types.InlineKeyboardMarkup()
            
            send_receipt_status = 'âœ…' if permissions.get('send_receipt', False) else 'âŒ'
            markup.row(types.InlineKeyboardButton(
                f'{send_receipt_status} Ø§Ø±Ø³Ø§Ù„ Ø±Ø³ÛŒØ¯',
                callback_data=f'toggleperm_{target_admin_id}_send_receipt'
            ))
            
            add_coins_status = 'âœ…' if permissions.get('add_coins', False) else 'âŒ'
            markup.row(types.InlineKeyboardButton(
                f'{add_coins_status} Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
                callback_data=f'toggleperm_{target_admin_id}_add_coins'
            ))
            
            remove_coins_status = 'âœ…' if permissions.get('remove_coins', False) else 'âŒ'
            markup.row(types.InlineKeyboardButton(
                f'{remove_coins_status} Ú©Ø³Ø± Ú©Ø±Ø¯Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ',
                callback_data=f'toggleperm_{target_admin_id}_remove_coins'
            ))
            
            gift_codes_status = 'âœ…' if permissions.get('manage_gift_codes', False) else 'âŒ'
            markup.row(types.InlineKeyboardButton(
                f'{gift_codes_status} Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡',
                callback_data=f'toggleperm_{target_admin_id}_manage_gift_codes'
            ))
            
            markup.row(
                types.InlineKeyboardButton('ğŸ—‘ Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†', callback_data=f'removeadmin_{target_admin_id}'),
            )
            markup.row(types.InlineKeyboardButton('ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª', callback_data='admin_manage'))
            
            try:
                bot.edit_message_text(
                    f'âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†\n\nğŸ‘¤ Ù†Ø§Ù…: {user["first_name"]}\nğŸ†” Ø¢ÛŒØ¯ÛŒ: {target_admin_id}\n\nğŸ“‹ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§:',
                    chat_id=call.message.chat.id,
                    message_id=call.message.message_id,
                    reply_markup=markup
                )
            except:
                bot.edit_message_reply_markup(
                    chat_id=call.message.chat.id,
                    message_id=call.message.message_id,
                    reply_markup=markup
                )
        
        bot.answer_callback_query(call.id, 'âœ… ØªØºÛŒÛŒØ± ÛŒØ§ÙØª')
        return
    
    elif data.startswith('removeadmin_'):
        if admin_id != CREATOR_ID:
            bot.answer_callback_query(call.id, 'âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯!')
            return
        
        target_admin_id = data.split('_')[1]
        
        if target_admin_id in admin_list:
            del admin_list[target_admin_id]
            save_data()
            
            bot.send_message(call.message.chat.id, f'âœ… Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ {target_admin_id} Ø­Ø°Ù Ø´Ø¯')
            
            try:
                bot.send_message(
                    int(target_admin_id),
                    'âš ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø´Ù…Ø§ Ù„ØºÙˆ Ø´Ø¯.',
                    reply_markup=get_main_keyboard()
                )
            except:
                pass
        
        bot.answer_callback_query(call.id, 'âœ… Ø§Ø¯Ù…ÛŒÙ† Ø­Ø°Ù Ø´Ø¯')
        
        markup = types.InlineKeyboardMarkup()
        for admin_id_str, admin_data in admin_list.items():
            if admin_id_str != str(CREATOR_ID):
                user = get_user(admin_id_str)
                markup.row(types.InlineKeyboardButton(
                    f"ğŸ‘¤ {user['first_name']} ({admin_id_str})",
                    callback_data=f'manageadmin_{admin_id_str}'
                ))
        
        markup.row(types.InlineKeyboardButton('ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª', callback_data='back_to_admin'))
        
        try:
            bot.edit_message_text(
                'ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§\n\nØ±ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:',
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                reply_markup=markup
            )
        except:
            pass
        
        return
    
    elif data.startswith('setamount_'):
        parts = data.split('_')
        action_type = parts[1]
        target_user_id = parts[2]
        amount = int(parts[3])
        
        markup = types.InlineKeyboardMarkup()
        markup.row(
            types.InlineKeyboardButton('âœ… ØªØ§ÛŒÛŒØ¯', callback_data=f'confirm_{action_type}_{target_user_id}_{amount}'),
            types.InlineKeyboardButton('âŒ Ù„ØºÙˆ', callback_data='cancel_admin')
        )
        
        action_text = 'Ú©Ø³Ø±' if action_type == 'remove' else 'Ø§Ø¶Ø§ÙÙ‡'
        user = get_user(target_user_id)
        
        text = f'''âš ï¸ ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ

ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {user['first_name']} ({target_user_id})
ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {user['coins']:,} Ø³Ú©Ù‡
ğŸ”„ Ù…Ù‚Ø¯Ø§Ø± {action_text}: {amount:,} Ø³Ú©Ù‡

Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ'''
        
        bot.edit_message_text(text, chat_id=call.message.chat.id, message_id=call.message.message_id, reply_markup=markup)
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('customamount_'):
        parts = data.split('_')
        action_type = parts[1]
        target_user_id = parts[2]
        
        waiting_for_admin_action[str(admin_id)] = {
            'step': 'waiting_custom_amount',
            'type': action_type,
            'target_user_id': target_user_id
        }
        
        bot.send_message(admin_id, 'ğŸ”¢ Ù…Ø¨Ù„Øº Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:')
        bot.answer_callback_query(call.id)
        return
    
    elif data.startswith('confirm_'):
        parts = data.split('_')
        action_type = parts[1]
        target_user_id = parts[2]
        amount = int(parts[3])
        
        user = get_user(target_user_id)
        
        if action_type == 'remove':
            if not has_permission(admin_id, 'remove_coins'):
                bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
                return
            
            users[target_user_id]['coins'] -= amount
            action_text = 'Ú©Ø³Ø±'
            emoji = 'â–'
        else:
            if not has_permission(admin_id, 'add_coins'):
                bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
                return
            
            users[target_user_id]['coins'] += amount
            action_text = 'Ø§Ø¶Ø§ÙÙ‡'
            emoji = 'â•'
        
        save_data()
        
        bot.edit_message_text(
            f'âœ… {action_text} Ø´Ø¯!\n\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {user["first_name"]}\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯: {users[target_user_id]["coins"]:,} Ø³Ú©Ù‡',
            chat_id=call.message.chat.id,
            message_id=call.message.message_id
        )
        
        try:
            keyboard = get_admin_keyboard() if is_admin(int(target_user_id)) else get_main_keyboard()
            bot.send_message(
                int(target_user_id),
                f'{emoji} Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ† ØªØºÛŒÛŒØ± Ú©Ø±Ø¯\n\nğŸ”„ Ù…Ù‚Ø¯Ø§Ø± {action_text}: {amount:,} Ø³Ú©Ù‡\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯: {users[target_user_id]["coins"]:,} Ø³Ú©Ù‡',
                reply_markup=keyboard
            )
        except:
            pass
        
        bot.answer_callback_query(call.id, 'âœ… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯')
        return
    
    elif data == 'cancel_admin' or data == 'back_to_admin':
        bot.delete_message(call.message.chat.id, call.message.message_id)
        bot.answer_callback_query(call.id, 'âŒ Ù„ØºÙˆ Ø´Ø¯')
        return
    
    if data.startswith('approve_') or data.startswith('reject_'):
        if not has_permission(admin_id, 'send_receipt') and admin_id != ADMIN_ID:
            bot.answer_callback_query(call.id, 'âŒ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
            return
        
        if data.startswith('approve_'):
            parts = data.split('_')
            user_id = parts[1]
            coins = int(parts[2])
            
            users[user_id]['coins'] += coins
            save_data()
            
            if f'charge_{user_id}' in admin_messages:
                for msg_info in admin_messages[f'charge_{user_id}']:
                    try:
                        bot.edit_message_caption(
                            f'âœ… ØªØ§ÛŒÛŒØ¯ Ø´Ø¯ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†\n\n{call.message.caption}',
                            chat_id=msg_info['chat_id'],
                            message_id=msg_info['message_id']
                        )
                    except:
                        pass
                del admin_messages[f'charge_{user_id}']
            
            keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
            bot.send_message(
                int(user_id),
                f'âœ… Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!\n\nğŸª™ {coins:,} Ø³Ú©Ù‡ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯\nğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: {users[user_id]["coins"]:,} Ø³Ú©Ù‡',
                reply_markup=keyboard
            )
            
            bot.answer_callback_query(call.id, 'âœ… Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯')
        
        elif data.startswith('reject_'):
            user_id = data.split('_')[1]
            
            if f'charge_{user_id}' in admin_messages:
                for msg_info in admin_messages[f'charge_{user_id}']:
                    try:
                        bot.edit_message_caption(
                            f'âŒ Ø±Ø¯ Ø´Ø¯ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†\n\n{call.message.caption}',
                            chat_id=msg_info['chat_id'],
                            message_id=msg_info['message_id']
                        )
                    except:
                        pass
                del admin_messages[f'charge_{user_id}']
            
            keyboard = get_admin_keyboard() if is_admin(int(user_id)) else get_main_keyboard()
            bot.send_message(
                int(user_id),
                'âŒ Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø±Ø¯ Ø´Ø¯\nÙ„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… Ø±Ù‡ÛŒØ¯',
                reply_markup=keyboard
            )
            
            bot.answer_callback_query(call.id, 'âŒ Ø±Ø³ÛŒØ¯ Ø´Ù…Ø§ Ø±Ø¯ Ø´Ø¯')
    
    elif data.startswith('join_'):
        parts = data.split('_')
        game_id = parts[1]
        creator_id = parts[2]
        user_id = str(call.from_user.id)
        username = call.from_user.username or call.from_user.first_name
        
        if game_id not in active_games:
            bot.answer_callback_query(call.id, 'âŒ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø¯ÛŒÚ¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯')
            return
        
        game = active_games[game_id]
        
        if user_id == creator_id:
            bot.answer_callback_query(call.id, 'âŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ¯ØªØ§Ù† Ø´Ø±Ú©Øª Ú©Ù†ÛŒØ¯!')
            return
        
        if len(game['participants']) >= 1:
            bot.answer_callback_query(call.id, 'âŒ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ù¾Ø± Ø§Ø³Øª!')
            return
        
        if users[user_id]['coins'] < game['amount']:
            bot.answer_callback_query(call.id, 'âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!')
            return
        
        game['participants'].append({'id': user_id, 'username': username})
        
        all_players = [game['creator']] + game['participants']
        winner = random.choice(all_players)
        loser = [p for p in all_players if p['id'] != winner['id']][0]
        
        tax = int(game['amount'] * TAX_RATE)
        prize = game['amount']
        final_prize = prize - tax
        
        users[winner['id']]['coins'] += final_prize
        users[loser['id']]['coins'] -= game['amount']
        save_data()
        
        result_text = f'''â—ˆ â”â”â” ğ†ğšğ¦ğ›ğ¥ğğ«ğ’ğ©ğ¢ğ«ğ¢ğ­ â”â”â” â—ˆ
ğ•ğˆğ | Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§Ø²ÛŒ :
ğ•ğˆğ | Ø¨Ø±Ù†Ø¯Ù‡ : {winner['username']} (<code>{winner['id']}</code>)
ğ•ğˆğ | Ø¨Ø§Ø²Ù†Ø¯Ù‡ : {loser['username']} (<code>{loser['id']}</code>)
ğ•ğˆğ | Ø¬Ø§ÛŒØ²Ù‡: {prize:,} Ø³Ú©Ù‡
ğ•ğˆğ | Ù…Ø§Ù„ÛŒØ§Øª: {tax:,} Ø³Ú©Ù‡
â—ˆ â”â”â” ğ†ğšğ¦ğ›ğ¥ğğ«ğ’ğ©ğ¢ğ«ğ¢ğ­ â”â”â” â—ˆ'''
        
        try:
            with open('game.jpg', 'rb') as photo:
                bot.edit_message_media(
                    media=types.InputMediaPhoto(photo, caption=result_text, parse_mode='HTML'),
                    chat_id=call.message.chat.id,
                    message_id=call.message.message_id
                )
        except:
            bot.edit_message_text(
                result_text,
                chat_id=call.message.chat.id,
                message_id=call.message.message_id,
                parse_mode='HTML'
            )
        
        del active_games[game_id]
        save_data()
        
        bot.answer_callback_query(call.id, 'ğŸ‰ Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§Ø²ÛŒ Ù…Ø´Ø®Øµ Ø´Ø¯!')
    
    elif data.startswith('close_'):
        parts = data.split('_')
        game_id = parts[1]
        creator_id = parts[2]
        user_id = str(call.from_user.id)
        
        if user_id != creator_id:
            bot.answer_callback_query(call.id, 'âŒ ÙÙ‚Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø¨Ø¨Ù†Ø¯Ø¯!')
            return
        
        if game_id not in active_games:
            bot.answer_callback_query(call.id, 'âŒ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø¯ÛŒÚ¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯')
            return
        
        try:
            bot.edit_message_caption(
                f'âŒ Ø¨Ø§Ø²ÛŒ ØªÙˆØ³Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯\n\n{call.message.caption}',
                chat_id=call.message.chat.id,
                message_id=call.message.message_id
            )
        except:
            bot.edit_message_text(
                f'âŒ Ø¨Ø§Ø²ÛŒ ØªÙˆØ³Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯',
                chat_id=call.message.chat.id,
                message_id=call.message.message_id
            )
        
        del active_games[game_id]
        save_data()
        
        bot.answer_callback_query(call.id, 'âœ… Ø¨Ø§Ø²ÛŒ Ø¨Ø³ØªÙ‡ Ø´Ø¯')

if __name__ == '__main__':
    import time
    
    print('ğŸ® Gambler Spirit Bot')
    print('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€')
    
    while True:
        try:
            print('ğŸ”— Ø§ØªØµØ§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...')
            bot.infinity_polling(timeout=30)
            
        except Exception as e:
            error_msg = str(e)
            print(f'âš ï¸ Ø®Ø·Ø§: {error_msg}')
            
            if 'timeout' in error_msg.lower():
                print('â° Ù…Ø´Ú©Ù„: Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¶Ø¹ÛŒÙ')
                wait_time = 15
            elif 'connection' in error_msg.lower():
                print('ğŸ”Œ Ù…Ø´Ú©Ù„: Ù‚Ø·Ø¹ÛŒ Ø§ÛŒÙ†ØªØ±Ù†Øª')
                wait_time = 20
            else:
                print('âŒ Ù…Ø´Ú©Ù„ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡')
                wait_time = 30
            
            print(f'ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø¯Ø± {wait_time} Ø«Ø§Ù†ÛŒÙ‡...')
            time.sleep(wait_time)
            print('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€')
            
            
            print('Ø±Ø¨Ø§Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³ØªØ§Ø±ØªğŸ”Œ ')
